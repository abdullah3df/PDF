<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CV Maker â€” ØµØ§Ù†Ø¹ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© PDF Ù…Ø¬Ø§Ù†ÙŠ</title>
  <meta name="description" content="Ø£Ù†Ø´Ø¦ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ© Ø¨Ù†ÙØ³Ùƒ: Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ØŒ Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ù„Ø¨ØŒ ÙˆØ´Ø§Ù‡Ø¯ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© Ø«Ù… Ø­Ù…Ù‘Ù„ PDF Ø¨Ø¬ÙˆØ¯Ø© A4. ÙŠØ¹Ù…Ù„ Ù…Ø¬Ø§Ù†Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±." />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1120;--card:#0f172a;--muted:#94a3b8;--text:#e2e8f0;--brand:#38bdf8;--brand-2:#22d3ee;--radius:1.2rem;--sheet-accent:#111}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:
      radial-gradient(1200px 600px at 80% -10%, rgba(56,189,248,.25), transparent 60%),
      radial-gradient(900px 500px at -10% 10%, rgba(34,211,238,.20), transparent 60%), var(--bg);
      color:var(--text);font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,Arial}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:800}
    .logo-badge{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--brand),var(--brand-2));display:grid;place-items:center;box-shadow:0 10px 30px rgba(34,211,238,.25)}
    .badge{font-size:12px;border:1px solid rgba(226,232,240,.12);padding:6px 10px;border-radius:999px;color:#cbd5e1;background:rgba(148,163,184,.06)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#0b1120;font-weight:800;border:none;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(226,232,240,.15);color:var(--text)}
    .grid{display:grid;gap:16px}
    .two{grid-template-columns:360px 1fr}
    .panel{background:linear-gradient(180deg, rgba(148,163,184,.08), rgba(148,163,184,.02));border:1px solid rgba(226,232,240,.08);border-radius:var(--radius);padding:16px}

    /* Sidebar builder full-height */
    #builder{position:sticky; top:12px; height:calc(100vh - 24px); overflow:auto}

    /* Inputs */
    input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(226,232,240,.12);background:#0c1326;color:var(--text);outline:none}
    textarea{min-height:90px;resize:vertical}
    label{font-weight:700;font-size:13px;margin-bottom:6px;display:block}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .row3{display:grid;gap:12px;grid-template-columns:1fr 1fr 1fr}

    .tools{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}

    /* CV Preview Sheet (Screen) */
    .sheet-wrap{background:#0c1326;border:1px solid rgba(226,232,240,.08);border-radius:12px;display:grid;place-items:center}
    .sheet{width:794px;min-height:1123px;background:#ffffff;color:#111;padding:26px 28px;position:relative}
    .tpl-classic h1{font-size:28px;margin:0}
    .meta{display:flex;gap:16px;flex-wrap:wrap;color:#333}
    .sec{margin-top:14px}
    .sec h3{margin:0 0 8px;border-bottom:2px solid var(--sheet-accent);display:inline-block}
    .item{margin:6px 0}
    .muted{color:#555}
    .left-right{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .skills, .langs{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--sheet-accent);border-radius:999px;padding:6px 10px;font-size:12px}
    .photo{position:absolute;top:28px;left:28px;width:86px;height:86px;border-radius:10px;object-fit:cover;border:2px solid #eee}

    /* Template: Sidebar */
    .tpl-sidebar{display:grid;grid-template-columns:230px 1fr;gap:22px}
    .tpl-sidebar .side{background:#f5f7fb;border-radius:10px;padding:16px;height:fit-content}
    .tpl-sidebar .side h3{margin:0 0 6px}

    /* Color palette */
    .swatches{display:flex;gap:10px;flex-wrap:wrap}
    .swatch{width:28px;height:28px;border-radius:999px;border:2px solid rgba(255,255,255,.6);cursor:pointer;box-shadow:0 0 0 2px rgba(0,0,0,.2) inset}
    .swatch[aria-checked="true"]{outline:3px solid rgba(255,255,255,.8)}

    /* Print styles */
    @media print{
      body{background:#fff}
      .no-print{display:none!important}
      .sheet{box-shadow:none}
      @page{size:A4;margin:14mm}
    }

    @media (max-width: 980px){
      .two{grid-template-columns:1fr}
      #builder{position:static;height:auto}
      .sheet{transform:scale(.86);transform-origin:top center}
    }
  </style>
</head>
<body>
  <header class="container nav no-print">
    <div class="logo">
      <div class="logo-badge">ğŸ“„</div>
      <span>CV Maker â€” ØµØ§Ù†Ø¹ Ø³ÙŠØ±Ø© PDF</span>
    </div>
    <div class="tools">
      <button class="btn" id="btnPrint">ØªØ­Ù…ÙŠÙ„ PDF</button>
      <button class="btn ghost" id="btnSave">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      <button class="btn ghost" id="btnLoad">Ø§Ø³ØªØ±Ø¬Ø§Ø¹</button>
      <button class="btn ghost" id="btnReset">Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
    </div>
  </header>

  <main class="container grid two">
    <!-- Builder -->
    <section class="panel no-print" id="builder">
      <h2 style="margin-top:0">Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ±ØªÙƒ</h2>

      <div class="row">
        <div>
          <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
          <input id="fullName" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø­ÙƒÙ…" />
        </div>
        <div>
          <label>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
          <input id="jobTitle" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø·ÙˆÙ‘Ø± ÙˆØ§Ø¬Ù‡Ø§Øª Ø£Ù…Ø§Ù…ÙŠØ©" />
        </div>
      </div>

      <div class="row3">
        <div>
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input id="email" placeholder="you@email.com" />
        </div>
        <div>
          <label>Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input id="phone" placeholder="+49 .." />
        </div>
        <div>
          <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
          <input id="location" placeholder="Stuttgart, DE" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Ø±Ø§Ø¨Ø· (Ù…ÙˆÙ‚Ø¹/LinkedIn)</label>
          <input id="website" placeholder="https://..." />
        </div>
        <div>
          <label>ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="photo" type="file" accept="image/*" />
        </div>
      </div>

      <label>Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‡Ù†ÙŠ</label>
      <textarea id="summary" placeholder="3-4 Ø£Ø³Ø·Ø± ØªÙ„Ø®Ù‘Øµ Ø®Ø¨Ø±ØªÙƒ ÙˆÙ‚ÙŠÙ…ØªÙƒ."></textarea>

      <div class="row">
        <div>
          <label>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª (Ø§ÙØµÙ„ Ø¨ÙÙˆØ§ØµÙ„)</label>
          <input id="skills" placeholder="JavaScript, React, CSS, Tailwind" />
        </div>
        <div>
          <label>Ø§Ù„Ù„ØºØ§Øª (Ø§ÙØµÙ„ Ø¨ÙÙˆØ§ØµÙ„)</label>
          <input id="languages" placeholder="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©ØŒ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© B2" />
        </div>
      </div>

      <h3 style="margin-top:10px">Ø§Ù„Ø®Ø¨Ø±Ø§Øª</h3>
      <div id="expList"></div>
      <button class="btn" id="addExp" type="button">+ Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø±Ø©</button>

      <h3 style="margin-top:16px">Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h3>
      <div id="eduList"></div>
      <button class="btn" id="addEdu" type="button">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ù‡Ù„</button>

      <h3 style="margin-top:16px">Ø§Ù„Ù‚Ø§Ù„Ø¨</h3>
      <div class="tools">
        <label class="badge"><input type="radio" name="tpl" value="classic" checked> ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ</label>
        <label class="badge"><input type="radio" name="tpl" value="sidebar"> Ø´Ø±ÙŠØ· Ø¬Ø§Ù†Ø¨ÙŠ</label>
      </div>

      <h3 style="margin-top:16px">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†</h3>
      <div class="swatches" id="swatches">
        <button class="swatch" type="button" data-theme='{"brand":"#38bdf8","brand2":"#22d3ee","accent":"#2563eb"}' style="background:linear-gradient(135deg,#38bdf8,#22d3ee)" aria-label="Ø£Ø²Ø±Ù‚" aria-checked="true"></button>
        <button class="swatch" type="button" data-theme='{"brand":"#a78bfa","brand2":"#7c3aed","accent":"#6d28d9"}' style="background:linear-gradient(135deg,#a78bfa,#7c3aed)" aria-label="Ø¨Ù†ÙØ³Ø¬ÙŠ"></button>
        <button class="swatch" type="button" data-theme='{"brand":"#34d399","brand2":"#10b981","accent":"#047857"}' style="background:linear-gradient(135deg,#34d399,#10b981)" aria-label="Ø£Ø®Ø¶Ø±"></button>
        <button class="swatch" type="button" data-theme='{"brand":"#fb7185","brand2":"#ef4444","accent":"#991b1b"}' style="background:linear-gradient(135deg,#fb7185,#ef4444)" aria-label="Ø£Ø­Ù…Ø±"></button>
        <button class="swatch" type="button" data-theme='{"brand":"#f59e0b","brand2":"#fbbf24","accent":"#b45309"}' style="background:linear-gradient(135deg,#f59e0b,#fbbf24)" aria-label="Ø°Ù‡Ø¨ÙŠ"></button>
        <button class="swatch" type="button" data-theme='{"brand":"#06b6d4","brand2":"#22d3ee","accent":"#0e7490"}' style="background:linear-gradient(135deg,#06b6d4,#22d3ee)" aria-label="ÙÙŠØ±ÙˆØ²ÙŠ"></button>
      </div>
    </section>

    <!-- Preview -->
    <section class="panel">
      <div class="sheet-wrap">
        <div class="sheet tpl-classic" id="sheet">
          <!-- ÙŠÙØ¹Ø§Ø¯ Ø¨Ù†Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø§Ù„Ø¨ -->
        </div>
      </div>
    </section>
  </main>

  <div class="container no-print" id="testStatus" style="font-size:12px;color:#cbd5e1;margin-top:8px"></div>

  <script>
    // ===== Helpers =====
    const $  = (sel)=>document.querySelector(sel);
    const $$ = (sel)=>Array.prototype.slice.call(document.querySelectorAll(sel)); // Array Ø¯Ø§Ø¦Ù…Ù‹Ø§
    const on = (el, evt, fn)=>{ if(el) el.addEventListener(evt, fn); };
    const state = {exp:[], edu:[], photoData:null, tpl:'classic'};

    // ===== Ù‚ÙˆØ§Ù„Ø¨ DOM =====
    function buildClassic(){
      return `
        <img id="p_photo" class="photo" alt="" style="display:none" />
        <h1 id="p_name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</h1>
        <div class="meta" id="p_meta"></div>
        <div class="sec"><h3>Ø§Ù„Ù…Ù„Ø®Øµ</h3><p id="p_summary" class="muted"></p></div>
        <div class="sec"><h3>Ø§Ù„Ø®Ø¨Ø±Ø§Øª</h3><div id="p_exp"></div></div>
        <div class="left-right sec">
          <div>
            <h3>Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h3>
            <div id="p_edu"></div>
          </div>
          <div>
            <h3>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
            <div class="skills" id="p_skills"></div>
            <h3 style="margin-top:12px">Ø§Ù„Ù„ØºØ§Øª</h3>
            <div class="langs" id="p_langs"></div>
          </div>
        </div>`;
    }
    function buildSidebar(){
      return `
        <div class="tpl-sidebar">
          <div class="side">
            <img id="p_photo" class="photo" style="position:static;width:100%;height:auto;border:none;display:${state.photoData?'block':'none'}" src="${state.photoData||''}" alt=""/>
            <h3>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
            <div class="skills" id="p_skills"></div>
            <h3>Ø§Ù„Ù„ØºØ§Øª</h3>
            <div class="langs" id="p_langs"></div>
            <h3>Ø§Ù„ØªÙˆØ§ØµÙ„</h3>
            <div class="muted" id="p_contact"></div>
          </div>
          <div>
            <h1 id="p_name"></h1>
            <div class="meta" id="p_meta"></div>
            <div class="sec"><h3>Ø§Ù„Ù…Ù„Ø®Øµ</h3><p id="p_summary" class="muted"></p></div>
            <div class="sec"><h3>Ø§Ù„Ø®Ø¨Ø±Ø§Øª</h3><div id="p_exp"></div></div>
            <div class="sec"><h3>Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h3><div id="p_edu"></div></div>
          </div>
        </div>`;
    }

    // ===== Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =====
    function fillTemplate(){
      const p = (id)=>document.getElementById(id);
      if(p('p_name')) p('p_name').textContent = state.fullName || 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„';

      const meta = [];
      if(state.jobTitle) meta.push(state.jobTitle);
      if(state.email)   meta.push(state.email);
      if(state.phone)   meta.push(state.phone);
      if(state.location)meta.push(state.location);
      if(state.website) meta.push(state.website);
      if(p('p_meta')) p('p_meta').textContent = meta.join(' â€¢ ');

      if(p('p_summary')) p('p_summary').textContent = state.summary || '';

      const expWrap = p('p_exp');
      if(expWrap){
        expWrap.innerHTML='';
        state.exp.forEach(x=>{
          const div=document.createElement('div');
          div.className='item';
          div.innerHTML = `<strong>${x.role||''}</strong> â€” ${x.company||''} <span class="muted">${x.dates||''}</span><br>${x.desc||''}`;
          expWrap.appendChild(div);
        });
      }

      const eduWrap = p('p_edu');
      if(eduWrap){
        eduWrap.innerHTML='';
        state.edu.forEach(x=>{
          const div=document.createElement('div');
          div.className='item';
          div.innerHTML = `<strong>${x.degree||''}</strong> â€” ${x.school||''} <span class="muted">${x.year||''}</span>${x.extra? '<br>'+x.extra:''}`;
          eduWrap.appendChild(div);
        });
      }

      const skillsWrap = p('p_skills');
      if(skillsWrap){
        skillsWrap.innerHTML='';
        state.skills.forEach(s=>{
          const span=document.createElement('span');
          span.className='chip'; span.textContent=s; skillsWrap.appendChild(span);
        });
      }

      const langsWrap = p('p_langs');
      if(langsWrap){
        langsWrap.innerHTML='';
        state.languages.forEach(s=>{
          const span=document.createElement('span');
          span.className='chip'; span.textContent=s; langsWrap.appendChild(span);
        });
      }

      const img = $('#p_photo');
      if(img){
        if(state.photoData){ img.src = state.photoData; img.style.display='block'; }
        else { img.style.display='none'; }
      }

      const contact = document.getElementById('p_contact');
      if(contact){
        contact.innerHTML = [state.email,state.phone,state.location,state.website].filter(Boolean).join('<br>');
      }
    }

    // ===== Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© =====
    function render(){
      const sheet = $('#sheet');
      if(!sheet) return;
      sheet.classList.remove('tpl-classic','tpl-mode-sidebar');
      sheet.classList.add(state.tpl==='classic' ? 'tpl-classic' : 'tpl-mode-sidebar');
      sheet.innerHTML = state.tpl==='classic' ? buildClassic() : buildSidebar();
      fillTemplate();
    }

    // ===== Ø¹Ù†Ø§ØµØ± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ù„Ù„Ù…Ø¯Ø®Ù„Ø§Øª =====
    function makeExpItem(item={role:'', company:'', dates:'', desc:''}){
      const wrap = document.createElement('div');
      wrap.className='panel';
      wrap.style.padding='12px';
      wrap.innerHTML = `
        <div class="row">
          <div><label>Ø§Ù„Ù…Ø³Ù…Ù‰</label><input class="i-role" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø·ÙˆÙ‘Ø± Frontend" value="${item.role||''}"></div>
          <div><label>Ø§Ù„Ø´Ø±ÙƒØ©</label><input class="i-company" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø±ÙƒØ© X" value="${item.company||''}"></div>
        </div>
        <div class="row">
          <div><label>Ø§Ù„Ù…Ø¯Ø©</label><input class="i-dates" placeholder="2022 - Ø§Ù„Ø¢Ù†" value="${item.dates||''}"></div>
          <div><label>ÙˆØµÙ Ù…Ø®ØªØµØ±</label><input class="i-desc" placeholder="Ø¥Ù†Ø¬Ø§Ø²Ø§Øª/Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª" value="${item.desc||''}"></div>
        </div>
        <div class="tools"><button class="btn ghost del" type="button">Ø­Ø°Ù</button></div>
      `;
      wrap.querySelector('.del').addEventListener('click',()=>{wrap.remove(); syncFromBuilder();});
      ['.i-role','.i-company','.i-dates','.i-desc'].forEach(s=>{
        wrap.querySelector(s).addEventListener('input', syncFromBuilder);
      });
      return wrap;
    }
    function makeEduItem(item={degree:'', school:'', year:'', extra:''}){
      const wrap = document.createElement('div');
      wrap.className='panel';
      wrap.style.padding='12px';
      wrap.innerHTML = `
        <div class="row">
          <div><label>Ø§Ù„Ø¯Ø±Ø¬Ø©</label><input class="e-degree" placeholder="Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³ Ø­Ø§Ø³ÙˆØ¨" value="${item.degree||''}"></div>
          <div><label>Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</label><input class="e-school" placeholder="Ø¬Ø§Ù…Ø¹Ø© ..." value="${item.school||''}"></div>
        </div>
        <div class="row">
          <div><label>Ø§Ù„Ø³Ù†Ø©</label><input class="e-year" placeholder="2021" value="${item.year||''}"></div>
          <div><label>ØªÙØ§ØµÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input class="e-extra" placeholder="Ù…Ø´Ø±ÙˆØ¹ ØªØ®Ø±Ø¬/Ù…Ø¹Ø¯Ù„" value="${item.extra||''}"></div>
        </div>
        <div class="tools"><button class="btn ghost del" type="button">Ø­Ø°Ù</button></div>
      `;
      wrap.querySelector('.del').addEventListener('click',()=>{wrap.remove(); syncFromBuilder();});
      ['.e-degree','.e-school','.e-year','.e-extra'].forEach(s=>{
        wrap.querySelector(s).addEventListener('input', syncFromBuilder);
      });
      return wrap;
    }

    on($('#addExp'),'click',()=>{ $('#expList').appendChild(makeExpItem()); syncFromBuilder(); });
    on($('#addEdu'),'click',()=>{ $('#eduList').appendChild(makeEduItem()); syncFromBuilder(); });

    // ===== Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
    on($('#photo'),'change',(e)=>{
      const file = e.target && e.target.files && e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{ state.photoData = reader.result; render(); };
      reader.readAsDataURL(file);
    });

    // ===== ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨
    const tplRadios = $$("input[name='tpl']");
    tplRadios.forEach(r=>{ r.addEventListener('change',()=>{ state.tpl = r.value; render(); autosave(); }); });

    // ===== Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
    function syncFromBuilder(){
      const g = (id)=>$(id).value? $(id).value.trim():'';
      state.fullName = $('#fullName')? g('#fullName'):'';
      state.jobTitle = $('#jobTitle')? g('#jobTitle'):'';
      state.email    = $('#email')? g('#email'):'';
      state.phone    = $('#phone')? g('#phone'):'';
      state.location = $('#location')? g('#location'):'';
      state.website  = $('#website')? g('#website'):'';
      state.summary  = $('#summary')? g('#summary'):'';
      state.skills   = $('#skills')? g('#skills').split(/,|ØŒ/).map(s=>s.trim()).filter(Boolean):[];
      state.languages= $('#languages')? g('#languages').split(/,|ØŒ/).map(s=>s.trim()).filter(Boolean):[];
      state.exp = Array.from($('#expList')? $('#expList').children:[]).map(el=>({
        role: (el.querySelector('.i-role')||{}).value?.trim()||'',
        company: (el.querySelector('.i-company')||{}).value?.trim()||'',
        dates: (el.querySelector('.i-dates')||{}).value?.trim()||'',
        desc: (el.querySelector('.i-desc')||{}).value?.trim()||'',
      })).filter(x=>x.role||x.company||x.desc||x.dates);
      state.edu = Array.from($('#eduList')? $('#eduList').children:[]).map(el=>({
        degree: (el.querySelector('.e-degree')||{}).value?.trim()||'',
        school: (el.querySelector('.e-school')||{}).value?.trim()||'',
        year: (el.querySelector('.e-year')||{}).value?.trim()||'',
        extra: (el.querySelector('.e-extra')||{}).value?.trim()||'',
      })).filter(x=>x.degree||x.school||x.year||x.extra);
      render();
      autosave();
    }
    ['#fullName','#jobTitle','#email','#phone','#location','#website','#summary','#skills','#languages']
      .forEach(sel=> on($(sel),'input', syncFromBuilder));

    // ===== Ø­ÙØ¸/Ø§Ø³ØªØ±Ø¬Ø§Ø¹
    function autosave(){ try{ localStorage.setItem('cv_data_v1', JSON.stringify(state)); } catch(e){ console.warn('Autosave blocked:', e); } }
    function loadSaved(){
      try{
        const raw = localStorage.getItem('cv_data_v1');
        if(!raw) return false;
        const s = JSON.parse(raw);
        Object.assign(state, s);
        if($('#fullName')) $('#fullName').value = s.fullName||'';
        if($('#jobTitle')) $('#jobTitle').value = s.jobTitle||'';
        if($('#email'))    $('#email').value = s.email||'';
        if($('#phone'))    $('#phone').value = s.phone||'';
        if($('#location')) $('#location').value = s.location||'';
        if($('#website'))  $('#website').value = s.website||'';
        if($('#summary'))  $('#summary').value = s.summary||'';
        if($('#skills'))   $('#skills').value = (s.skills||[]).join(', ');
        if($('#languages'))$('#languages').value = (s.languages||[]).join(', ');
        if($('#expList')){ $('#expList').innerHTML=''; (s.exp||[]).forEach(e=>$('#expList').appendChild(makeExpItem(e))); }
        if($('#eduList')){ $('#eduList').innerHTML=''; (s.edu||[]).forEach(e=>$('#eduList').appendChild(makeEduItem(e))); }
        state.tpl = s.tpl||'classic';
        $$("input[name='tpl']").forEach(r=>{ r.checked = (r.value===state.tpl); });
        render();
        return true;
      }catch(e){ console.warn('Load failed:', e); return false; }
    }

    // ===== Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ©
    function applyTheme(theme){
      if(!theme) return;
      document.documentElement.style.setProperty('--brand', theme.brand);
      document.documentElement.style.setProperty('--brand-2', theme.brand2);
      document.documentElement.style.setProperty('--sheet-accent', theme.accent);
      state.theme = theme; autosave(); render();
    }
    const savedThemeRaw = localStorage.getItem('cv_theme_v1');
    if(savedThemeRaw){ try{ applyTheme(JSON.parse(savedThemeRaw)); }catch{} }

    $$('#swatches .swatch').forEach(btn=>{
      btn.addEventListener('click',()=>{
        $$('#swatches .swatch').forEach(b=>b.setAttribute('aria-checked','false'));
        btn.setAttribute('aria-checked','true');
        const theme = JSON.parse(btn.getAttribute('data-theme'));
        applyTheme(theme);
        try{ localStorage.setItem('cv_theme_v1', JSON.stringify(theme)); }catch{}
      });
    });

    // ===== Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
    on($('#btnPrint'),'click',()=>{ window.print(); });
    on($('#btnSave'),'click',()=>{ autosave(); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².'); });
    on($('#btnLoad'),'click',()=>{ if(!loadSaved()) alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©.'); });
    on($('#btnReset'),'click',()=>{ if(confirm('Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ØŸ')){ try{localStorage.removeItem('cv_data_v1');localStorage.removeItem('cv_theme_v1');}catch{} location.reload(); } });

    // ===== ØªÙ‡ÙŠØ¦Ø© Ù…Ø¨Ø¯Ø¦ÙŠØ©
    if($('#expList')) $('#expList').appendChild(makeExpItem());
    if($('#eduList')) $('#eduList').appendChild(makeEduItem());
    render();

    // ===== Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°Ø§ØªÙŠØ© Ø¨Ø³ÙŠØ·Ø© (ØªØ¸Ù‡Ø± Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø©)
    (function runTests(){
      const out = [];
      try{
        out.push($$("input[name='tpl']").length>0 ? 'âœ” ØªÙˆØ¬Ø¯ Ø£Ø²Ø±Ø§Ø± Ù‚ÙˆØ§Ù„Ø¨ tpl' : 'âœ– Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø²Ø±Ø§Ø± tpl');
        out.push(Array.isArray($$("input[name='tpl'])) ? 'âœ” $$ ÙŠØ¹ÙŠØ¯ Array' : 'âœ– $$ Ù„Ø§ ÙŠØ¹ÙŠØ¯ Array');
        const before = state.exp.length; if($('#addExp')) $('#addExp').click();
        out.push(state.exp.length>=before ? 'âœ” Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø±Ø© ØªØ¹Ù…Ù„' : 'âœ– Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø®Ø¨Ø±Ø§Øª');
        state.fullName = 'Ø§Ø®ØªØ¨Ø§Ø±'; render();
        out.push((document.getElementById('p_name')?.textContent||'').includes('Ø§Ø®ØªØ¨Ø§Ø±') ? 'âœ” ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙŠØ¹Ù…Ù„' : 'âœ– ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ù„Ø§ ÙŠØ¹Ù…Ù„');
        const tbtn = document.querySelector('#swatches .swatch'); if(tbtn){ tbtn.click(); out.push('âœ” ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ÙˆÙ† ÙŠØ¹Ù…Ù„'); }
        state.tpl='sidebar'; render();
        out.push(document.querySelector('#sheet .tpl-sidebar') ? 'âœ” Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ÙŠØ¹Ù…Ù„' : 'âœ– ÙØ´Ù„ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ');
        state.tpl='classic'; render();
        out.push(document.getElementById('p_name') ? 'âœ” Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ ÙŠØ¹Ù…Ù„' : 'âœ– ÙØ´Ù„ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ');
      }catch(e){ out.push('âœ– Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: '+e.message); }
      const box = document.getElementById('testStatus');
      if(box) box.textContent = 'Tests: ' + out.join(' â€¢ ');
      state.fullName = ''; render();
    })();
  </script>
</body>
</html>
