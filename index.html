<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>صانع سيرة ذاتية — معاينة يدوية وتصدير PDF</title>

<style>
:root{
  /* ألوان واجهة الموقع (الأزرار والهيدر) */
  --ui-brand:#2563eb; --ui-brand-2:#1e3a8a;
  --site-bg:#dce6f2; /* خلفية الموقع */

  /* ألوان ورقة السيرة (داخل الورقة) */
  --accent:#3a6ea5;  /* لون الشريط الجانبي */
  --text:#0b1220; --muted:#475569; --chip:#1f2937;

  /* قياسات */
  --sheet-w:210mm; --sheet-h:297mm;
  --bar-w:56mm; /* شريط جانبي مناسب، غيّره لـ 50–60mm حسب ذوقك */
  --radius:14px;
}

*{box-sizing:border-box}
html,body{margin:0}
body{
  font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--site-bg); color:#0b1220;
}

/* رأس وأزرار الواجهة (ألوانها منفصلة عن الورقة) */
.header{max-width:980px;margin:16px auto 8px;padding:0 12px;display:flex;align-items:center;gap:10px;justify-content:space-between}
.brand{font-weight:800;display:flex;align-items:center;gap:8px}
.badge{font-size:12px;background:#fff;border:1px solid rgba(2,6,23,.12);padding:6px 10px;border-radius:999px;color:#334155}
.toolbar{max-width:980px;margin:0 auto 12px;padding:12px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.btn{appearance:none;border:none;cursor:pointer;padding:10px 14px;border-radius:10px;background:linear-gradient(135deg,var(--ui-brand),var(--ui-brand-2));color:#fff;font-weight:800;box-shadow:0 6px 14px rgba(0,0,0,.18)}
.btn.ghost{background:#fff;color:#0b1220;border:1px solid rgba(2,6,23,.15);box-shadow:none;font-weight:700}

/* لوحة الإدخال */
.editor{max-width:980px;margin:0 auto 14px;background:#fff;border:1px solid rgba(2,6,23,.12);border-radius:14px;padding:12px}
label{font-weight:700;font-size:13px;margin-bottom:6px;display:block}
.input,textarea,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(2,6,23,.15);background:#fff;color:#0b1220;outline:none}
.help{font-size:12px;color:#64748b;margin:4px 2px 10px}
.grid{display:grid;gap:12px}
.two{grid-template-columns:1fr 1fr}
.three{grid-template-columns:repeat(3,1fr)}
@media (max-width:860px){.two,.three{grid-template-columns:1fr}}

/* المعاينة */
.sheet-wrap{max-width:calc(var(--sheet-w) + 32px);margin:0 auto 40px;padding:16px;border-radius:16px;background:#ffffffb3;border:1px solid rgba(2,6,23,.08)}
.sheet{width:var(--sheet-w);min-height:var(--sheet-h);background:#fff;position:relative;border-radius:var(--radius);overflow:hidden;box-shadow:0 24px 60px rgba(0,0,0,.22);color:var(--text)}

/* الشريط الجانبي الحقيقي */
.sheet.with-sidebar .bar{position:absolute;top:0;bottom:0;right:0;width:var(--bar-w);background:var(--accent);color:#fff;border-radius:0 var(--radius) var(--radius) 0}
[dir="rtl"] .sheet.with-sidebar .bar{left:0;right:auto;border-radius:var(--radius) 0 0 var(--radius)}

.content{position:relative;z-index:2;padding:18mm}
.sheet.with-sidebar .content{padding-inline-end:calc(18mm + var(--bar-w) + 6mm)}
h1,h2,h3{margin:0 0 8px} h1{font-size:26px} h2{font-size:20px} h3{font-size:16px;border-bottom:2px solid var(--chip);display:inline-block;padding-bottom:2px;margin-top:14px}
.meta{display:flex;gap:12px;flex-wrap:wrap;color:#334155}
.chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.chip{border:1px solid var(--chip);border-radius:999px;padding:6px 10px;font-size:12px}

/* بطاقة فوق الشريط (تعرض مهارات/لغات/تواصل) */
.side-card{position:absolute;z-index:3;top:18mm;inset-inline-end:12mm;width:calc(var(--bar-w) - 24mm);background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;color:#0b1220}
[dir="rtl"] .side-card{inset-inline-start:12mm;inset-inline-end:auto}

/* وضع الطباعة */
.print-mode .header,.print-mode .toolbar,.print-mode .editor{display:none!important}
.print-mode body,.print-mode .sheet-wrap{background:#fff!important}
.print-mode .sheet{box-shadow:none;border-radius:0}
@media print{
  body{margin:0;background:#fff!important}
  .header,.toolbar,.editor{display:none!important}
  .sheet-wrap{max-width:unset;border:0;padding:0;margin:0;background:#fff!important}
  .sheet{width:210mm!important;min-height:297mm!important;border-radius:0;box-shadow:none}
  @page{size:A4;margin:0}
}

/* موبايل */
@media (max-width:520px){
  :root{--bar-w:48mm}
  .sheet.with-sidebar .content{padding:14mm}
  .side-card{display:none}
}
</style>
</head>
<body>

<!-- واجهة الموقع (ألوان منفصلة) -->
<div class="header">
  <div class="brand">📄 <span>صانع سيرة ذاتية</span></div>
  <span class="badge">معاينة يدوية • PDF نظيف</span>
</div>
<div class="toolbar">
  <button class="btn" id="btnPreview">معاينة</button>
  <button class="btn" id="btnPrint">تصدير PDF</button>
  <button class="btn ghost" id="btnToggle">إظهار / إخفاء التعديل</button>
</div>

<!-- نموذج الإدخال (بتلميحات واضحة) -->
<div class="editor" id="editor">
  <div class="grid two">
    <div>
      <label>الاسم الكامل</label>
      <input id="i_name" class="input" placeholder="اكتب اسمك الثلاثي أو الرباعي (مثال: عبد الله محمد الحكم)" />
      <div class="help">سيظهر أعلى الورقة بحجم كبير.</div>
    </div>
    <div>
      <label>المسمى الوظيفي</label>
      <input id="i_title" class="input" placeholder="مثال: مطوّر واجهات أمامية | React" />
      <div class="help">يفضّل أن يكون مختصرًا ووصفيًا.</div>
    </div>
  </div>

  <div class="grid three">
    <div>
      <label>البريد</label>
      <input id="i_email" class="input" placeholder="استخدم بريدًا احترافيًا (name.lastname@gmail.com)" />
    </div>
    <div>
      <label>الهاتف</label>
      <input id="i_phone" class="input" placeholder="رقم مع رمز الدولة (مثال: +49 151 2345678)" />
    </div>
    <div>
      <label>المدينة</label>
      <input id="i_city" class="input" placeholder="مثال: Berlin, DE" />
    </div>
  </div>

  <div>
    <label>الرابط (اختياري)</label>
    <input id="i_site" class="input" placeholder="LinkedIn أو موقع شخصي (مثال: linkedin.com/in/username)" />
  </div>

  <div>
    <label>الملخص المهني</label>
    <textarea id="i_summary" rows="3" class="input" placeholder="3–4 جمل: سنوات خبرة + مجال + إنجاز ملحوظ + ما تبحث عنه"></textarea>
  </div>

  <div class="grid two">
    <div>
      <label>المهارات (افصل بفواصل)</label>
      <input id="i_skills" class="input" placeholder="JavaScript, React, CSS, Git" />
      <div class="help">رتّب من الأقوى للأقل.</div>
    </div>
    <div>
      <label>اللغات (افصل بفواصل + مستوى)</label>
      <input id="i_langs" class="input" placeholder="العربية (أم)، الإنجليزية B2" />
    </div>
  </div>

  <div class="grid two">
    <div>
      <label>الخبرات — HTML بسيط</label>
      <textarea id="i_exp" rows="5" class="input" placeholder="<p><strong>المسمى</strong> — الشركة <span style='color:#64748b'>2022–الآن</span><br>• إنجاز مختصر<br>• مسؤولية رئيسية</p>"></textarea>
      <div class="help">يسمح بـ &lt;p&gt; و &lt;strong&gt; و &lt;br&gt; والنقاط.</div>
    </div>
    <div>
      <label>التعليم — HTML بسيط</label>
      <textarea id="i_edu" rows="5" class="input" placeholder="<p><strong>بكالوريوس علوم الحاسوب</strong> — جامعة X <span style='color:#64748b'>2021</span><br>مشروع تخرج / معدل.</p>"></textarea>
    </div>
  </div>

  <div class="grid two">
    <div>
      <label>القالب</label>
      <div style="display:flex;gap:12px;align-items:center">
        <label><input type="radio" name="tpl" value="sidebar" checked> شريط جانبي</label>
        <label><input type="radio" name="tpl" value="classic"> بدون شريط</label>
      </div>
      <div class="help">اختر شريط أو لا. حجم الشريط مضبوط حتى لا يأكل الصفحة.</div>
    </div>
    <div>
      <label>ألوان ورقة السيرة/واجهة الموقع</label>
      <div class="grid two">
        <div>
          <input id="i_accent" type="color" class="input" value="#3a6ea5" />
          <div class="help">لون الشريط (داخل الورقة).</div>
        </div>
        <div>
          <input id="i_ui" type="color" class="input" value="#2563eb" />
          <div class="help">لون الأزرار (خارج الورقة).</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- المعاينة -->
<div class="sheet-wrap">
  <div class="sheet with-sidebar" id="sheet">
    <div class="bar" id="bar">
      <div class="side-card" id="sideCard">
        <h3 style="margin-top:0">التواصل</h3>
        <div id="v_contact" style="font-size:13px;line-height:1.6"></div>
        <h3 style="margin-top:10px">المهارات</h3>
        <div id="v_skills_side" class="chips"></div>
        <h3 style="margin-top:10px">اللغات</h3>
        <div id="v_langs_side" class="chips"></div>
      </div>
    </div>
    <div class="content">
      <h1 id="v_name">الاسم الكامل</h1>
      <div class="meta" id="v_meta"></div>

      <h3>الملخص</h3>
      <p id="v_summary" style="margin:6px 0 10px"></p>

      <h3>الخبرات</h3>
      <div id="v_exp"></div>

      <h3>التعليم</h3>
      <div id="v_edu"></div>
    </div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s); const $$=s=>Array.from(document.querySelectorAll(s));
const KEY='cv_manual_preview_v1';

/* تحويل قائمة نصية إلى Chips */
function chips(str){
  const frag=document.createDocumentFragment();
  str.split(/,|،/).map(s=>s.trim()).filter(Boolean).forEach(t=>{
    const sp=document.createElement('span'); sp.className='chip'; sp.textContent=t; frag.appendChild(sp);
  }); return frag;
}

/* المعاينة اليدوية فقط عند الضغط على زر "معاينة" */
function preview(){
  // فصل الألوان: ورقة السيرة
  document.documentElement.style.setProperty('--accent', $('#i_accent').value || '#3a6ea5');
  // ألوان الواجهة
  document.documentElement.style.setProperty('--ui-brand', $('#i_ui').value || '#2563eb');

  // تبديل القالب
  const tpl = document.querySelector('input[name="tpl"]:checked')?.value || 'sidebar';
  const sheet = $('#sheet');
  if(tpl==='sidebar') sheet.classList.add('with-sidebar'); else sheet.classList.remove('with-sidebar');

  // اسم + ميتا
  $('#v_name').textContent = $('#i_name').value || 'الاسم الكامل';
  const meta=[];
  if($('#i_title').value) meta.push($('#i_title').value);
  if($('#i_email').value) meta.push($('#i_email').value);
  if($('#i_phone').value) meta.push($('#i_phone').value);
  if($('#i_city').value)  meta.push($('#i_city').value);
  if($('#i_site').value)  meta.push($('#i_site').value);
  $('#v_meta').textContent = meta.join(' • ');

  // ملخص
  $('#v_summary').textContent = $('#i_summary').value || '';

  // خبرات/تعليم (HTML بسيط)
  $('#v_exp').innerHTML = $('#i_exp').value || '';
  $('#v_edu').innerHTML = $('#i_edu').value || '';

  // البطاقة الجانبية: تواصل/مهارات/لغات
  const contactHTML = [$('#i_email').value,$('#i_phone').value,$('#i_city').value,$('#i_site').value]
    .filter(Boolean).join('<br>');
  $('#v_contact').innerHTML = contactHTML || '';

  const s=$('#v_skills_side'); s.innerHTML=''; s.appendChild(chips($('#i_skills').value||''));
  const l=$('#v_langs_side'); l.innerHTML=''; l.appendChild(chips($('#i_langs').value||''));
}

/* حفظ/استرجاع (اختياري لكنه مفيد) */
function save(){
  const data={
    name:$('#i_name').value,title:$('#i_title').value,email:$('#i_email').value,phone:$('#i_phone').value,
    city:$('#i_city').value,site:$('#i_site').value,summary:$('#i_summary').value,
    skills:$('#i_skills').value,langs:$('#i_langs').value,exp:$('#i_exp').value,edu:$('#i_edu').value,
    accent:$('#i_accent').value,ui:$('#i_ui').value,tpl:document.querySelector('input[name="tpl"]:checked')?.value||'sidebar'
  };
  localStorage.setItem(KEY, JSON.stringify(data));
  alert('تم الحفظ.');
}
function load(){
  const raw=localStorage.getItem(KEY);
  if(!raw){ alert('لا يوجد بيانات محفوظة.'); return; }
  try{
    const d=JSON.parse(raw);
    $('#i_name').value=d.name||''; $('#i_title').value=d.title||'';
    $('#i_email').value=d.email||''; $('#i_phone').value=d.phone||'';
    $('#i_city').value=d.city||''; $('#i_site').value=d.site||'';
    $('#i_summary').value=d.summary||''; $('#i_skills').value=d.skills||'';
    $('#i_langs').value=d.langs||''; $('#i_exp').value=d.exp||''; $('#i_edu').value=d.edu||'';
    $('#i_accent').value=d.accent||'#3a6ea5'; $('#i_ui').value=d.ui||'#2563eb';
    if(d.tpl){ $$('input[name="tpl"]').forEach(r=>r.checked=(r.value===d.tpl)); }
    alert('تم الاسترجاع.'); 
  }catch{ alert('تعذّر الاسترجاع.'); }
}

/* طباعة PDF دقيقة */
function enterPrint(){ document.body.classList.add('print-mode'); }
function exitPrint(){ document.body.classList.remove('print-mode'); }
function printPDF(){ enterPrint(); setTimeout(()=>{ window.print(); setTimeout(exitPrint,800); },60); }

/* أزرار */
$('#btnPreview').addEventListener('click', preview);
$('#btnPrint').addEventListener('click', printPDF);
$('#btnToggle').addEventListener('click', ()=>{ const ed=$('#editor'); ed.style.display = (ed.style.display==='none'?'block':'none'); });

/* اختصار: Ctrl/Cmd + P ينصح بالمعاينة قبل الطباعة */
window.addEventListener('keydown',e=>{
  if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='p'){ if(confirm('هل تريد تحديث المعاينة قبل الطباعة؟')) preview(); }
});

/* تهيئة مبدئية: حمّل إن وجد ثم اعرض معاينة أولى */
(function init(){
  const raw=localStorage.getItem(KEY);
  if(raw){ try{ const d=JSON.parse(raw);
    $('#i_name').value=d.name||''; $('#i_title').value=d.title||'';
    $('#i_email').value=d.email||''; $('#i_phone').value=d.phone||'';
    $('#i_city').value=d.city||''; $('#i_site').value=d.site||'';
    $('#i_summary').value=d.summary||''; $('#i_skills').value=d.skills||'';
    $('#i_langs').value=d.langs||''; $('#i_exp').value=d.exp||''; $('#i_edu').value=d.edu||'';
    $('#i_accent').value=d.accent||'#3a6ea5'; $('#i_ui').value=d.ui||'#2563eb';
    if(d.tpl){ $$('input[name="tpl"]').forEach(r=>r.checked=(r.value===d.tpl)); }
  }catch{} }
  preview(); // معاينة أولى بالتخطيط الافتراضي
})();
</script>
</body>
</html>
