<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CV Builder â€” Ù…Ù†Ø´Ø¦ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</title>
  <meta name="description" content="Ù…Ù†Ø´Ø¦ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¨Ø«Ù„Ø§Ø« Ù„ØºØ§Øª Ù…Ø¹ Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙˆØªØµØ¯ÙŠØ± PDF Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§ØªØŒ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1220; --bg2:#0d152b;
      --card:#111a2f; --card2:#0e1629;
      --ink:#0b1220; --ink2:#1a243a;
      --text:#e9eefb; --muted:#9fb0d6;
      --brand:#3aa9ff; --brand2:#7ee787; --danger:#ff6b6b; --ok:#22c55e; --warn:#f59e0b;
      --ring: 0 0 0 2px rgb(58 169 255 / .25) inset;
      --radius:18px;
      --paper:#ffffff; --border:#e9edf5;
    }
    *{box-sizing:border-box; -webkit-print-color-adjust:exact; print-color-adjust:exact}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),var(--bg2));
      color:var(--text);
      font-family: "Cairo", "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans Arabic", sans-serif;
    }
    a{ color:var(--brand); text-decoration:none }
    .container{max-width:1200px;margin:auto;padding:18px}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:linear-gradient(180deg,#0f1933,#0b1220);
      border:1px solid #203055;border-radius:16px;padding:12px 14px;margin-bottom:14px;
      position:sticky; top:8px; z-index:10;
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .badge{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;
      background:radial-gradient(circle at 30% 30%,var(--brand),#6dd3ff 40%,#0049ff); box-shadow:0 6px 18px rgba(0,0,0,.25) }
    .lang{display:flex;gap:8px;align-items:center}
    .seg{display:inline-flex;border:1px solid #223555;border-radius:12px;overflow:hidden}
    .seg button{background:#0e1626;color:var(--text);border:0;padding:8px 10px;cursor:pointer;font-weight:700}
    .seg button[aria-pressed="true"]{background:linear-gradient(180deg,#14243f,#0f1a32);box-shadow:var(--ring)}
    .main{display:grid;grid-template-columns: 420px 1fr; gap:16px}
    @media (max-width: 1020px){ .main{grid-template-columns:1fr} }
    .card{
      background:linear-gradient(180deg,var(--card),var(--card2));
      border:1px solid #223555;border-radius:18px;padding:16px;box-shadow:0 14px 30px rgba(0,0,0,.25)
    }
    .card h2{margin:0 0 8px;font-size:20px}
    .muted{color:var(--muted);font-size:13px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .field{display:flex;flex-direction:column;gap:6px;margin:8px 0}
    .field label{font-size:13px;color:#c8d3ee}
    .input,.textarea{
      width:100%;padding:11px 12px;border-radius:12px;border:1px solid #2a3c62;background:#0f1a30;color:var(--text);outline:none
    }
    .input:focus,.textarea:focus{ box-shadow: var(--ring); border-color:#2a4c88 }
    .textarea{min-height:110px;resize:vertical}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #2b3e66;background:#14223b;color:var(--text);cursor:pointer}
    .btn.brand{background:linear-gradient(180deg,#1a6eff,#1147ff);border-color:#2f55ff}
    .btn.good{background:linear-gradient(180deg,#15803d,#166534);border-color:#2e7d32}
    .btn.warn{background:linear-gradient(180deg,#d97706,#b45309);border-color:#b45309}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .hint{font-size:12px;color:#a9b6d7}
    .cv{
      background:linear-gradient(180deg,#0e1529,#0c1222);
      border:1px solid #273455;border-radius:16px;padding:16px
    }
    /* Ø£Ø¨Ø¹Ø§Ø¯ A4 Ù…Ù†Ø·Ù‚ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© (â‰ˆ 96dpi): 794Ã—1123 */
    .sheet{
      width:794px; min-height:1123px; margin:auto; background:var(--paper); color:#0d1426;
      border-radius:8px; box-shadow: 0 0 0 1px var(--border) inset, 0 10px 30px rgba(0,0,0,.2); overflow:hidden
    }
    @media (max-width: 820px){ .sheet{ width:100% } }
    .cv-header{display:flex;gap:16px;align-items:center;padding:22px 26px;background:linear-gradient(90deg,#0b1220 0%,#133869 100%);color:#fff}
    .avatar{width:84px;height:84px;border-radius:50%;background:#d1d5db;overflow:hidden;border:3px solid rgba(255,255,255,.18)}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .cv-titlebox{display:flex;flex-direction:column}
    .cv-name{font-size:26px;font-weight:800;margin:0;color:#fff}
    .cv-role{opacity:.95}
    .cv-body{display:grid;grid-template-columns:280px 1fr}
    @media (max-width: 720px){ .cv-body{grid-template-columns:1fr} }
    .cv-side{background:#f6f8fc;padding:18px}
    .cv-main{padding:22px}
    .block{margin-bottom:14px}
    .block h3{margin:0 0 6px;font-size:14px;color:#0b1325}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#1e3a8a;font-size:12px;margin:0 6px 6px 0}
    .contact{font-size:13px;color:#ffffffcc}
    .hr{height:1px;background:#e6eaf3;margin:10px 0}
    .footer-note{margin-top:18px;text-align:center;font-size:12px;color:var(--muted)}

    @page{ size:A4; margin:10mm }
    @media print{
      body{ background:#fff }
      .container, .topbar{ display:none !important }
      .sheet{ box-shadow:none !important }
    }

    .overlay{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(5,10,20,.55); z-index:99999; backdrop-filter: blur(2px);
    }
    .overlay.show{ display:flex }
    .dialog{ min-width:260px; max-width:90vw; background:#0f1933; color:#e4ebff; border:1px solid #2a3f6a; border-radius:14px; padding:14px }
    .dialog .title{ font-weight:800; margin:0 0 6px }
    .dialog .msg{ font-size:14px; color:#bfd0ff }
    .spinner{ width:36px; height:36px; border-radius:50%; border:4px solid #2a3f6a; border-top-color:#4ea3ff; animation:spin 1s linear infinite; margin:10px auto }
    @keyframes spin { to{ transform: rotate(360deg) } }
  </style>
</head>
<body>
  <div class="container">
    <header class="topbar">
      <div class="brand">
        <div class="badge">ğŸ“„</div>
        <div style="display:flex;flex-direction:column">
          <strong id="t-app">Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</strong>
          <small class="muted" id="t-sub">Ù…Ù†Ø´Ø¦ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</small>
        </div>
      </div>
      <div class="lang">
        <span class="muted" id="t-lang">Ø§Ù„Ù„ØºØ©</span>
        <div class="seg" role="group" aria-label="Language">
          <button id="btn-ar" aria-pressed="true">AR</button>
          <button id="btn-en" aria-pressed="false">EN</button>
          <button id="btn-de" aria-pressed="false">DE</button>
        </div>
      </div>
    </header>

    <main class="main">
      <section class="card">
        <h2 id="t-form">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
        <p class="muted" id="t-form-hint">Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø«Ù… Ø­Ø¯Ù‘Ø« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ§Ø¶ØºØ· ØªÙ†Ø²ÙŠÙ„ PDF.</p>

        <div class="field"><label id="l-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input id="i-name" class="input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" /></div>
        <div class="field"><label id="l-role">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label><input id="i-role" class="input" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø·ÙˆÙ‘Ø± ÙˆØ§Ø¬Ù‡Ø§Øª" /></div>
        <div class="grid2">
          <div class="field"><label id="l-city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ø¯ÙˆÙ„Ø©</label><input id="i-city" class="input" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø±Ù„ÙŠÙ†ØŒ Ø£Ù„Ù…Ø§Ù†ÙŠØ§" /></div>
          <div class="field"><label id="l-phone">Ø§Ù„Ù‡Ø§ØªÙ</label><input id="i-phone" class="input" placeholder="+49 0000 000000" /></div>
        </div>
        <div class="grid2">
          <div class="field"><label id="l-email">Ø§Ù„Ø¨Ø±ÙŠØ¯</label><input id="i-email" class="input" placeholder="you@example.com" /></div>
          <div class="field"><label id="l-website">Ø§Ù„Ù…ÙˆÙ‚Ø¹/Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù†</label><input id="i-web" class="input" placeholder="linkedin.com/in/you" /></div>
        </div>

        <div class="field"><label id="l-summary">Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‡Ù†ÙŠ</label>
          <textarea id="i-summary" class="textarea" placeholder="Ù†Ø¨Ø°Ø© Ù‚ØµÙŠØ±Ø© Ø¹Ù† Ø®Ø¨Ø±ØªÙƒ ÙˆØ¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ..."></textarea>
        </div>

        <div class="field"><label id="l-exp">Ø§Ù„Ø®Ø¨Ø±Ø§Øª (Ø³Ø·Ø± Ù„ÙƒÙ„ Ø®Ø¨Ø±Ø©)</label>
          <textarea id="i-exp" class="textarea" placeholder="Ø§Ù„Ø´Ø±ÙƒØ© â€” Ø§Ù„Ù…Ù†ØµØ¨ â€” Ø§Ù„Ù…Ø¯Ø©&#10;..."></textarea>
        </div>

        <div class="field"><label id="l-edu">Ø§Ù„ØªØ¹Ù„ÙŠÙ…</label>
          <textarea id="i-edu" class="textarea" placeholder="Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© â€” Ø§Ù„Ø¯Ø±Ø¬Ø© â€” Ø§Ù„Ø³Ù†Ø©&#10;..."></textarea>
        </div>

        <div class="field"><label id="l-skills">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)</label>
          <input id="i-skills" class="input" placeholder="JavaScript, React, Teamwork, ..." />
        </div>

        <div class="field"><label id="l-photo">Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input type="file" id="i-photo" class="input" accept="image/*" />
          <small class="hint" id="t-photo-hint">ÙŠØªÙ… ØªØµØºÙŠØ± Ø§Ù„ØµÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡.</small>
        </div>

        <div class="row" style="margin-top:6px">
          <button class="btn brand" id="btn-update">ğŸ” <span id="t-update">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</span></button>
          <button class="btn good" id="btn-download">â¬‡ï¸ <span id="t-download">ØªÙ†Ø²ÙŠÙ„ PDF</span></button>
          <button class="btn warn" id="btn-clear">ğŸ§¹ <span id="t-clear">ØªÙØ±ÙŠØº</span></button>
        </div>
      </section>

      <section class="card cv">
        <h2 id="t-preview">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</h2>
        <div id="sheet" class="sheet" aria-label="A4 Preview">
          <div class="cv-header">
            <div class="avatar" id="v-avatar"></div>
            <div class="cv-titlebox">
              <h1 class="cv-name" id="v-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</h1>
              <div class="cv-role" id="v-role">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</div>
              <div class="contact" id="v-contact">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© â€¢ Ø§Ù„Ù‡Ø§ØªÙ â€¢ Ø§Ù„Ø¨Ø±ÙŠØ¯ â€¢ Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
            </div>
          </div>
          <div class="cv-body">
            <aside class="cv-side">
              <div class="block">
                <h3 id="t-skills-h">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
                <div id="v-skills"></div>
              </div>
            </aside>
            <main class="cv-main">
              <section class="block">
                <h3 id="t-summary-h">Ø§Ù„Ù…Ù„Ø®Øµ</h3>
                <p id="v-summary">Ø§ÙƒØªØ¨ Ù…Ù„Ø®ØµÙƒ Ø§Ù„Ù…Ù‡Ù†ÙŠ Ø¨Ø¥ÙŠØ¬Ø§Ø² ÙˆÙˆØ¶ÙˆØ­.</p>
              </section>
              <div class="hr"></div>
              <section class="block">
                <h3 id="t-exp-h">Ø§Ù„Ø®Ø¨Ø±Ø§Øª</h3>
                <div id="v-exp"></div>
              </section>
              <div class="hr"></div>
              <section class="block">
                <h3 id="t-edu-h">Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h3>
                <div id="v-edu"></div>
              </section>
            </main>
          </div>
        </div>
        <div class="footer-note" id="t-local">* ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ.</div>
      </section>
    </main>
  </div>

  <div id="overlay" class="overlay" aria-live="polite" aria-modal="true" role="dialog">
    <div class="dialog">
      <div class="title" id="ov-title">ÙŠØªÙ… Ø§Ù„ØªØ­Ø¶ÙŠØ±â€¦</div>
      <div class="spinner" id="ov-spin"></div>
      <div class="msg" id="ov-msg">Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ù‹Ø§ Ù…Ù† ÙØ¶Ù„Ùƒ.</div>
    </div>
  </div>

  <!-- Ù…ÙƒØªØ¨Ø§Øª Ù…ÙˆØ«ÙˆÙ‚Ø© -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5fQp+f7YHnY0Xw3F7Yv4fZrF0w1F7f3Wj2R7gqk7wB1l2v7oV0Q4uQeQ7z7s1qkQ4zPq+v2k0QmJ1a9v4Zw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-NaWen3+e9Z1J8QFQiz0t2dXzKJ2r2y0q7mW4R8tXw0o1d8q1bL0QIRm6m1yYI8R1sQO9b7E5k9m6lA0a0yUpxA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    // ===== i18n =====
    const i18n = {
      ar:{ dir:"rtl",
        "t-app":"Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©","t-sub":"Ù…Ù†Ø´Ø¦ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©",
        "t-lang":"Ø§Ù„Ù„ØºØ©","t-form":"Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª","t-form-hint":"Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø«Ù… Ø­Ø¯Ù‘Ø« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ§Ø¶ØºØ· ØªÙ†Ø²ÙŠÙ„ PDF.",
        "l-name":"Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„","l-role":"Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ","l-city":"Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ø¯ÙˆÙ„Ø©","l-phone":"Ø§Ù„Ù‡Ø§ØªÙ",
        "l-email":"Ø§Ù„Ø¨Ø±ÙŠØ¯","l-website":"Ø§Ù„Ù…ÙˆÙ‚Ø¹/Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù†","l-summary":"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‡Ù†ÙŠ",
        "l-exp":"Ø§Ù„Ø®Ø¨Ø±Ø§Øª (Ø³Ø·Ø± Ù„ÙƒÙ„ Ø®Ø¨Ø±Ø©)","l-edu":"Ø§Ù„ØªØ¹Ù„ÙŠÙ…","l-skills":"Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)","l-photo":"Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
        "t-photo-hint":"ÙŠØªÙ… ØªØµØºÙŠØ± Ø§Ù„ØµÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡.",
        "t-update":"ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©","t-download":"ØªÙ†Ø²ÙŠÙ„ PDF","t-clear":"ØªÙØ±ÙŠØº",
        "t-preview":"Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©","t-skills-h":"Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª","t-summary-h":"Ø§Ù„Ù…Ù„Ø®Øµ","t-exp-h":"Ø§Ù„Ø®Ø¨Ø±Ø§Øª","t-edu-h":"Ø§Ù„ØªØ¹Ù„ÙŠÙ…","t-local":"* ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ.",
        "ph-name":"Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„","ph-role":"Ù…Ø«Ø§Ù„: Ù…Ø·ÙˆÙ‘Ø± ÙˆØ§Ø¬Ù‡Ø§Øª","ph-city":"Ù…Ø«Ø§Ù„: Ø¨Ø±Ù„ÙŠÙ†ØŒ Ø£Ù„Ù…Ø§Ù†ÙŠØ§","ph-phone":"+49 0000 000000","ph-email":"you@example.com","ph-web":"linkedin.com/in/you",
        "ov-prep":"ÙŠØªÙ… Ø§Ù„ØªØ­Ø¶ÙŠØ±â€¦","ov-wait":"Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ù‹Ø§ Ù…Ù† ÙØ¶Ù„Ùƒ.","ov-export":"ØªÙˆÙ„ÙŠØ¯ PDFâ€¦","ov-done":"ØªÙ…Ù‘ Ø§Ù„ØªØ­Ù…ÙŠÙ„ âœ…",
        "err-export":"Ø­Ø¯Ø«Øª Ù…Ø´ÙƒÙ„Ø© Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ PDF. Ø¬Ø±Ù‘Ø¨ Ø«Ø§Ù†ÙŠØ© Ø£Ùˆ Ù‚Ù„Ù„ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±."
      },
      en:{ dir:"ltr",
        "t-app":"CV Builder","t-sub":"Professional rÃ©sumÃ© builder that works on every device",
        "t-lang":"Language","t-form":"Details","t-form-hint":"Fill the fields, update preview, then download the PDF.",
        "l-name":"Full Name","l-role":"Job Title","l-city":"City/Country","l-phone":"Phone",
        "l-email":"Email","l-website":"Website/LinkedIn","l-summary":"Professional Summary",
        "l-exp":"Experience (one per line)","l-edu":"Education","l-skills":"Skills (comma-separated)","l-photo":"Photo (optional)",
        "t-photo-hint":"Your photo is automatically downsized for performance.",
        "t-update":"Update Preview","t-download":"Download PDF","t-clear":"Clear",
        "t-preview":"Preview","t-skills-h":"Skills","t-summary-h":"Summary","t-exp-h":"Experience","t-edu-h":"Education","t-local":"* Data is saved locally in your browser.",
        "ph-name":"Full Name","ph-role":"e.g., Frontend Developer","ph-city":"e.g., Berlin, Germany","ph-phone":"+49 0000 000000","ph-email":"you@example.com","ph-web":"linkedin.com/in/you",
        "ov-prep":"Preparingâ€¦","ov-wait":"Please wait a moment.","ov-export":"Generating PDFâ€¦","ov-done":"Downloaded âœ…",
        "err-export":"There was a problem generating the PDF. Try again or use smaller images."
      },
      de:{ dir:"ltr",
        "t-app":"Lebenslauf-Builder","t-sub":"Professioneller Lebenslauf-Generator fÃ¼r alle GerÃ¤te",
        "t-lang":"Sprache","t-form":"Daten","t-form-hint":"Felder ausfÃ¼llen, Vorschau aktualisieren und als PDF herunterladen.",
        "l-name":"VollstÃ¤ndiger Name","l-role":"Berufsbezeichnung","l-city":"Stadt/Land","l-phone":"Telefon",
        "l-email":"E-Mail","l-website":"Website/LinkedIn","l-summary":"Berufliches Profil",
        "l-exp":"Erfahrung (eine pro Zeile)","l-edu":"Ausbildung","l-skills":"FÃ¤higkeiten (durch Komma getrennt)","l-photo":"Foto (optional)",
        "t-photo-hint":"Ihr Foto wird automatisch verkleinert.",
        "t-update":"Vorschau aktualisieren","t-download":"PDF herunterladen","t-clear":"Leeren",
        "t-preview":"Vorschau","t-skills-h":"FÃ¤higkeiten","t-summary-h":"Zusammenfassung","t-exp-h":"Erfahrung","t-edu-h":"Ausbildung","t-local":"* Daten werden lokal gespeichert.",
        "ph-name":"VollstÃ¤ndiger Name","ph-role":"z. B. Frontend-Entwickler","ph-city":"z. B. Berlin, Deutschland","ph-phone":"+49 0000 000000","ph-email":"you@example.com","ph-web":"linkedin.com/in/you",
        "ov-prep":"Wird vorbereitetâ€¦","ov-wait":"Bitte einen Moment warten.","ov-export":"PDF wird erstelltâ€¦","ov-done":"Heruntergeladen âœ…",
        "err-export":"Beim Erstellen des PDFs ist ein Problem aufgetreten. Versuchen Sie es erneut oder verwenden Sie kleinere Bilder."
      }
    };

    const $ = s => document.querySelector(s);

    function setLang(lang){
      const dict = i18n[lang] || i18n.ar;
      document.documentElement.lang = lang;
      document.documentElement.dir = dict.dir;
      // Ù†ØµÙˆØµ
      [
        "t-app","t-sub","t-lang","t-form","t-form-hint","l-name","l-role","l-city","l-phone",
        "l-email","l-website","l-summary","l-exp","l-edu","l-skills","l-photo","t-photo-hint",
        "t-update","t-download","t-clear","t-preview","t-skills-h","t-summary-h","t-exp-h","t-edu-h","t-local","ov-prep","ov-wait"
      ].forEach(k=>{ const el = document.getElementById(k); if(el) el.textContent = dict[k]; });
      // Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
      $("#i-name").placeholder = dict["ph-name"];
      $("#i-role").placeholder = dict["ph-role"];
      $("#i-city").placeholder = dict["ph-city"];
      $("#i-phone").placeholder = dict["ph-phone"];
      $("#i-email").placeholder = dict["ph-email"];
      $("#i-web").placeholder = dict["ph-web"];
      localStorage.setItem("cv-lang", lang);
      // Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      $("#btn-ar").setAttribute("aria-pressed", lang==="ar");
      $("#btn-en").setAttribute("aria-pressed", lang==="en");
      $("#btn-de").setAttribute("aria-pressed", lang==="de");
      // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø¹Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
      const data = load() || {};
      render(data);
    }
    $("#btn-ar").onclick = ()=> setLang("ar");
    $("#btn-en").onclick = ()=> setLang("en");
    $("#btn-de").onclick = ()=> setLang("de");

    // ===== Data handling =====
    function lines(v){ return (v||"").split(/\r?\n/).map(s=>s.trim()).filter(Boolean); }
    function tags(v){ return (v||"").split(",").map(s=>s.trim()).filter(Boolean); }

    function save(){
      const data = {
        name: $("#i-name").value || "",
        role: $("#i-role").value || "",
        city: $("#i-city").value || "",
        phone: $("#i-phone").value || "",
        email: $("#i-email").value || "",
        web: $("#i-web").value || "",
        summary: $("#i-summary").value || "",
        exp: lines($("#i-exp").value),
        edu: lines($("#i-edu").value),
        skills: tags($("#i-skills").value),
        photo: localStorage.getItem("cv-photo") || null,
      };
      localStorage.setItem("cv-data", JSON.stringify(data));
      return data;
    }
    function load(){
      try { return JSON.parse(localStorage.getItem("cv-data")) || null; } catch{ return null; }
    }

    function render(data){
      const lang = document.documentElement.lang || "ar";
      const dict = i18n[lang] || i18n.ar;

      $("#v-name").textContent = data.name || dict["ph-name"] || "Full Name";
      $("#v-role").textContent = data.role || dict["ph-role"] || "Job Title";

      // Ø³Ø·Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ â€” Ù†Ø¸Ù‡Ø±Ù‡ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø¥Ù† ÙˆÙØ¬Ø¯Øª Ø£ÙŠ Ù‚ÙŠÙ…Ø©
      const parts = [];
      if (data.city) parts.push(data.city);
      if (data.phone) parts.push(data.phone);
      if (data.email) parts.push(data.email);
      if (data.web) parts.push(data.web);
      $("#v-contact").textContent = parts.join(" â€¢ ");

      // Ø§Ù„Ù…Ù„Ø®Øµ
      $("#v-summary").textContent = data.summary || (dict["t-summary-h"] + "...");

      // Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
      const skillsBox = $("#v-skills"); skillsBox.innerHTML = "";
      (data.skills||[]).forEach(s=>{
        const t=document.createElement("span"); t.className="tag"; t.textContent=s; skillsBox.appendChild(t);
      });

      // Ø§Ù„Ø®Ø¨Ø±Ø§Øª
      const expV = $("#v-exp"); expV.innerHTML="";
      (data.exp||[]).forEach(line=>{
        const p=document.createElement("p"); p.style.margin="0 0 6px"; p.style.color= "#0b1325"; p.textContent=line; expV.appendChild(p);
      });

      // Ø§Ù„ØªØ¹Ù„ÙŠÙ…
      const eduV = $("#v-edu"); eduV.innerHTML="";
      (data.edu||[]).forEach(line=>{
        const p=document.createElement("p"); p.style.margin="0 0 6px"; p.style.color= "#0b1325"; p.textContent=line; eduV.appendChild(p);
      });

      // Ø§Ù„ØµÙˆØ±Ø©
      const av = $("#v-avatar");
      av.innerHTML = data.photo ? `<img src="${data.photo}" alt="photo" />` : "";
    }

    // ØªØ­Ø¯ÙŠØ« Ø­ÙŠÙ‘ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© + Ø²Ø± ØªØ­Ø¯ÙŠØ«
    const inputsToWatch = ["i-name","i-role","i-city","i-phone","i-email","i-web","i-summary","i-exp","i-edu","i-skills"];
    inputsToWatch.forEach(id=>{
      const el = document.getElementById(id);
      el.addEventListener("input", ()=>{ const d=save(); render(d); });
    });
    $("#btn-update").onclick = ()=>{ const d=save(); render(d); };

    $("#btn-clear").onclick = ()=>{
      inputsToWatch.forEach(id=>{ $("#"+id).value=""; });
      localStorage.removeItem("cv-data"); localStorage.removeItem("cv-photo");
      render(save());
    };

    // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ ØªØµØºÙŠØ±
    $("#i-photo").addEventListener("change", async (e)=>{
      const f = e.target.files && e.target.files[0]; if(!f) return;
      const dataUrl = await readAndDownscaleImage(f, 1200);
      localStorage.setItem("cv-photo", dataUrl);
      render(save());
    });

    function readAndDownscaleImage(file, maxSide){
      return new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.onload = ()=>{
          const img = new Image();
          img.onload = ()=>{
            const ratio = Math.min(1, maxSide / Math.max(img.width, img.height));
            const w = Math.round(img.width * ratio), h = Math.round(img.height * ratio);
            const c = document.createElement("canvas"); c.width = w; c.height = h;
            const ctx = c.getContext("2d"); ctx.drawImage(img, 0, 0, w, h);
            resolve(c.toDataURL("image/jpeg", 0.9));
          };
          img.onerror = reject;
          img.src = reader.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // ===== Overlay =====
    const overlay = $("#overlay"), ovTitle=$("#ov-title"), ovMsg=$("#ov-msg");
    function showOverlay(title, msg, spin=true){
      overlay.classList.add("show");
      ovTitle.textContent = title; ovMsg.textContent = msg;
      $("#ov-spin").style.display = spin ? "block" : "none";
    }
    function hideOverlay(){ overlay.classList.remove("show"); }

    // ===== PDF Export (A4 Ø­Ù‚ÙŠÙ‚ÙŠ + ØªÙ‚Ø·ÙŠØ¹ ØµÙØ­Ø§Øª) =====
    $("#btn-download").onclick = async ()=>{
      const lang = document.documentElement.lang || "ar";
      const dict = i18n[lang] || i18n.ar;
      showOverlay(dict["ov-export"], dict["ov-wait"], true);

      try{
        // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ·
        if (document.fonts && document.fonts.ready) { try { await document.fonts.ready; } catch{} }

        // ØªØ¬Ù‡ÙŠØ² Ù†Ø³Ø®Ø© Ù…Ø±Ø¦ÙŠØ© Ù…Ø®ÙÙŠØ© Ù„Ù„Ø§Ù„ØªÙ‚Ø§Ø·
        const sheet = $("#sheet");
        const clone = sheet.cloneNode(true);
        clone.setAttribute("dir", document.documentElement.dir);
        Object.assign(clone.style,{
          position:"fixed", left:"0", top:"0",
          background:"#ffffff", color:"#0b1220",
          width: sheet.offsetWidth+"px",
          visibility:"hidden", pointerEvents:"none", transform:"none", filter:"none", display:"block", zIndex: -1
        });
        document.body.appendChild(clone);
        void clone.offsetHeight;

        // Ø§Ù†ØªØ¸Ø± Ø§Ù„ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø³Ø®Ø©
        await waitImages(clone);

        // Ø§Ù„ØªÙ‚Ø· Ø¨Ù€ html2canvas Ø¨Ø¯Ù‚Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
        const scale = Math.min(2, Math.max(1.5, (window.devicePixelRatio||1)));
        const canvas = await html2canvas(clone, {
          scale,
          useCORS: true,
          backgroundColor: "#ffffff",
          logging: false,
          removeContainer: true,
          windowWidth: clone.scrollWidth,
          windowHeight: clone.scrollHeight
        });

        // Ø¥Ø¹Ø¯Ø§Ø¯ jsPDF A4 (Ù†Ù‚Ø·Ø© pt)
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({ unit:"pt", format:"a4", orientation:"portrait" });
        const pageWidth  = pdf.internal.pageSize.getWidth();   // 595.28
        const pageHeight = pdf.internal.pageSize.getHeight();  // 841.89

        // Ø­ÙˆÙ„ Ø§Ù„Ù€ canvas Ø¥Ù„Ù‰ ØµÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„ØµÙØ­Ø§Øª Ø¥Ù† Ù„Ø²Ù…
        const imgWidth = pageWidth;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        if (imgHeight <= pageHeight){
          const imgData = canvas.toDataURL("image/jpeg", 0.95);
          pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, imgHeight);
        } else {
          // ØªÙ‚Ø·ÙŠØ¹ Ø±Ø£Ø³ÙŠ Ù„Ù„ÙƒØ§Ù†ÙØ³ Ø¹Ù„Ù‰ Ø§Ø±ØªÙØ§Ø¹ ØµÙØ­Ø©
          const onePageCanvas = document.createElement("canvas");
          const ctx = onePageCanvas.getContext("2d");
          onePageCanvas.width = canvas.width;
          const pageCanvasHeight = Math.floor((pageHeight * canvas.width) / pageWidth);

          let renderedY = 0;
          let pageIndex = 0;
          while (renderedY < canvas.height){
            const sliceHeight = Math.min(pageCanvasHeight, canvas.height - renderedY);
            onePageCanvas.height = sliceHeight;
            ctx.clearRect(0, 0, onePageCanvas.width, onePageCanvas.height);
            ctx.drawImage(canvas, 0, renderedY, canvas.width, sliceHeight, 0, 0, onePageCanvas.width, sliceHeight);
            const imgData = onePageCanvas.toDataURL("image/jpeg", 0.95);
            if (pageIndex === 0){
              pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, (sliceHeight * imgWidth) / onePageCanvas.width);
            } else {
              pdf.addPage();
              pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, (sliceHeight * imgWidth) / onePageCanvas.width);
            }
            renderedY += sliceHeight;
            pageIndex++;
          }
        }

        const fname = (($("#i-name").value || "CV").trim().replace(/\s+/g,"_")) + ".pdf";
        pdf.save(fname);

        ovTitle.textContent = dict["ov-done"];
        $("#ov-spin").style.display="none";
        ovMsg.textContent = "";
        setTimeout(hideOverlay, 700);

        clone.remove();
      }catch(err){
        console.error(err);
        alert((i18n[document.documentElement.lang]||i18n.ar)["err-export"]);
        hideOverlay();
      }
    };

    function waitImages(root){
      const imgs = Array.from(root.querySelectorAll("img"));
      if (imgs.length === 0) return Promise.resolve();
      return Promise.all(imgs.map(img=>{
        if (img.complete && img.naturalWidth) return Promise.resolve();
        return new Promise(res=>{
          img.onload = ()=>res();
          img.onerror = ()=>res(); // Ù„Ø§ ØªÙˆÙ‚Ù Ø§Ù„ØªØµØ¯ÙŠØ± Ù„Ùˆ ÙØ´Ù„Øª ØµÙˆØ±Ø©
        });
      }));
    }

    // ===== Init =====
    (function init(){
      const lang = localStorage.getItem("cv-lang") || "ar";
      setLang(lang);
      const data = load();
      if(data){
        $("#i-name").value = data.name || "";
        $("#i-role").value = data.role || "";
        $("#i-city").value = data.city || "";
        $("#i-phone").value = data.phone || "";
        $("#i-email").value = data.email || "";
        $("#i-web").value = data.web || "";
        $("#i-summary").value = data.summary || "";
        $("#i-exp").value = (data.exp||[]).join("\n");
        $("#i-edu").value = (data.edu||[]).join("\n");
        $("#i-skills").value = (data.skills||[]).join(", ");
        if(data.photo) localStorage.setItem("cv-photo", data.photo);
        render(data);
      }else{
        render(save());
      }
    })();
  </script>
</body>
</html>
