<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø®Ø¯Ù…Ø§Øª PDF & CV â€” Ù…ÙˆÙ‚Ø¹ Ù…ØªÙƒØ§Ù…Ù„ Ø¨Ù…Ù„Ù ÙˆØ§Ø­Ø¯</title>
  <meta name="description" content="Ø£Ø¯ÙˆØ§Øª PDF (Ø¯Ù…Ø¬ØŒ ØªÙ‚Ø³ÙŠÙ…ØŒ ØµÙˆØ±â†’PDF) + Ù…Ù†Ø´Ø¦ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ù…Ø¹ ØªØµØ¯ÙŠØ± PDF â€” ÙƒÙ„Ù‘Ù‡Ø§ ØªØ¹Ù…Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­.">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <style>
    :root { --bg:#0b1220; --card:#ffffff; --muted:#555; --text:#000; --brand:#3aa9ff; --danger:#ff6b6b; --radius:18px; }
    *{ box-sizing:border-box; -webkit-print-color-adjust:exact; print-color-adjust:exact }
    body{
      margin:0; color:var(--text);
      background:linear-gradient(180deg,var(--bg),#0d1426 35%,#0a0f1d 100%);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans Arabic",Tahoma,Arial,sans-serif
    }
    a{color:var(--brand)}
    .container{max-width:1180px;margin:auto;padding:24px}
    .nav{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:16px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:800;color:#fff}
    .logo-badge{width:36px;height:36px;border-radius:50%;display:grid;place-items:center;background:radial-gradient(circle at 30% 30%,var(--brand),#6dd3ff 40%,#0049ff)}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab-btn{border:1px solid #223050;background:#0e1626;color:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;transition:.2s}
    .tab-btn[aria-selected="true"], .tab-btn:hover{background:linear-gradient(180deg,#12213b,#0e1626);border-color:#2a3a5d;box-shadow:0 0 0 2px rgb(58 169 255 / .18) inset}

    .grid{display:grid;grid-template-columns:1.15fr 1fr;gap:18px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);color:#000;border:1px solid #d7dce6;border-radius:var(--radius);padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.15)}
    .card h2{margin:0 0 6px;font-size:20px}
    .muted{color:var(--muted);font-size:13px}

    .panel{display:none}
    .panel.active{display:block;animation:fade .25s ease}
    @keyframes fade{from{opacity:.4;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

    .drop{border:1.5px dashed #35507f;border-radius:14px;padding:18px;text-align:center;background:#f8f8f8;color:#000}
    .drop input{display:none}
    .drop label{display:inline-block;padding:10px 14px;border-radius:10px;background:#13213a;color:#fff;border:1px solid #2b3e66;cursor:pointer}

    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #2b3e66;background:#14223b;color:#fff;cursor:pointer}
    .btn.brand{background:linear-gradient(180deg,#1a6eff,#1147ff);border-color:#2f55ff}
    .btn.good{background:linear-gradient(180deg,#15803d,#166534);border-color:#2e7d32}
    .btn.danger{background:linear-gradient(180deg,#b91c1c,#7f1d1d);border-color:#7f1d1d}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

    .list{margin:10px 0 0;padding:0;list-style:none;max-height:200px;overflow:auto;border:1px solid #e4e8f1;border-radius:12px}
    .list li{padding:8px 12px;border-bottom:1px solid #edf0f6;font-size:14px;display:flex;justify-content:space-between;gap:10px;align-items:center;color:#000}
    .list li:last-child{border-bottom:0}
    .list .actions{display:flex;gap:6px}

    .field{display:flex;flex-direction:column;gap:6px;margin:8px 0;color:#000}
    .field input,.field textarea, .field select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #cdd5e3;background:#fff;color:#000}
    .field textarea{min-height:110px;resize:vertical}

    .cv{background:#fff;color:#000;border:1px solid #d7dce6;border-radius:16px;padding:18px}
    /* A4 Ù…Ø¹Ø§ÙŠÙ†Ø©: Ø£Ø¨Ø¹Ø§Ø¯ Ø¨ÙƒØ³Ù„ ÙˆØ§Ø¶Ø­Ø© Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· */
    .cv .sheet{
      width:794px; min-height:1123px;
      background:#ffffff; color:#000;
      margin:auto; border-radius:8px; box-shadow:0 0 0 1px #e6eaf3 inset; overflow:hidden
    }
    .cv .sheet, .cv .sheet *{ -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale }

    .cv-header{display:flex;gap:16px;align-items:center;padding:22px 26px;background:#133869;color:#fff}
    .avatar{width:84px;height:84px;border-radius:50%;background:#d1d5db;overflow:hidden;border:3px solid rgba(255,255,255,.18)}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .cv-body{display:grid;grid-template-columns:280px 1fr}
    @media (max-width: 720px){.cv-body{grid-template-columns:1fr}}
    .cv-side{background:#f6f8fc;padding:18px}
    .cv-main{padding:22px}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#1e3a8a;font-size:12px;margin:0 4px 6px 0}

    .footer{margin-top:28px;text-align:center;font-size:12px;color:#d7deea}
    .site-footer{margin-top:28px;text-align:center;font-size:12px;color:#cbd5e1}
  </style>
</head>
<body>
  <div class="container">
    <div class="nav">
      <div class="logo" title="Ø®Ø¯Ù…Ø§Øª PDF & CV">
        <span class="logo-badge">ğŸ“„</span>
        <span>Ø®Ø¯Ù…Ø§Øª PDF & CV</span>
      </div>
      <div class="tabs" role="tablist" aria-label="Ø§Ù„Ø£Ù‚Ø³Ø§Ù…">
        <button class="tab-btn" data-tab="pdf" aria-selected="true">Ø£Ø¯ÙˆØ§Øª PDF</button>
        <button class="tab-btn" data-tab="cv">Ù…Ù†Ø´Ø¦ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</button>
        <button class="tab-btn" data-tab="about">Ø§Ù„ØªØ¹Ø±ÙŠÙ & Ø§Ù„ØªØ³Ø¹ÙŠØ±</button>
      </div>
    </div>

    <!-- PDF TOOLS -->
    <section id="panel-pdf" class="panel active">
      <div class="grid">
        <div class="card">
          <h2>Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF</h2>
          <p class="muted">Ø§Ø±ÙØ¹ Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª PDF Ø¨ØªØ±ØªÙŠØ¨Ùƒ Ø«Ù… Ø§Ø¶ØºØ· Ø¯Ù…Ø¬. ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù„Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ù„Ø£Ø²Ø±Ø§Ø± â†‘ â†“.</p>
          <div class="drop" id="merge-drop">
            <input type="file" id="merge-input" accept="application/pdf" multiple>
            <label for="merge-input">Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª PDF</label>
            <ul id="merge-list" class="list" aria-live="polite"></ul>
          </div>
          <div class="row" style="margin-top:10px">
            <button class="btn brand" id="merge-btn">Ø¯Ù…Ù€Ø¬ ÙˆØªØ­Ù…ÙŠÙ„</button>
            <button class="btn" id="merge-clear">ØªÙØ±ÙŠØº</button>
          </div>
        </div>

        <div class="card">
          <h2>ØªÙ‚Ø³ÙŠÙ… Ù…Ù„Ù PDF</h2>
          <p class="muted">Ø£Ø¯Ø®Ù„ Ø§Ù„ØµÙØ­Ø§Øª Ù…Ø«Ù„: <b>1-3, 5, 8-9</b> â€” ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</p>
          <div class="field">
            <input type="file" id="split-input" accept="application/pdf">
          </div>
          <div class="field">
            <label for="ranges">Ù†Ø·Ø§Ù‚ Ø§Ù„ØµÙØ­Ø§Øª</label>
            <input id="ranges" placeholder="Ù…Ø«Ø§Ù„: 1-2,4,7-9" />
          </div>
          <div class="row">
            <button class="btn brand" id="split-btn">ØªÙ‚Ø³ÙŠÙ… ÙˆØªØ­Ù…ÙŠÙ„</button>
            <button class="btn" id="split-clear">ØªÙØ±ÙŠØº</button>
          </div>
        </div>

        <div class="card">
          <h2>ØµÙˆØ± â†’ PDF</h2>
          <p class="muted">Ø­ÙˆÙ‘Ù„ ØµÙˆØ± JPG/PNG Ø¥Ù„Ù‰ PDF (ØµÙØ­Ø© Ù„ÙƒÙ„ ØµÙˆØ±Ø©) â€” ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø­Ù„ÙŠÙ‹Ø§.</p>
          <div class="field">
            <input type="file" id="img2pdf-input" accept="image/*" multiple>
          </div>
          <div class="row">
            <label>Ø­Ø¬Ù… Ø§Ù„ØµÙØ­Ø©:
              <select id="paper"><option value="a4">A4</option><option value="letter">Letter</option></select>
            </label>
            <label>Ù…Ù„Ø§Ø¡Ù…Ø©:
              <select id="fit"><option value="contain">Ø§Ø­ØªÙˆØ§Ø¡</option><option value="cover">Ù…Ù„Ø¡ Ø§Ù„ØµÙØ­Ø©</option></select>
            </label>
            <button class="btn good" id="img2pdf-btn">ØªØ­ÙˆÙŠÙ„ ÙˆØªØ­Ù…ÙŠÙ„</button>
          </div>
        </div>

        <div class="card">
          <h2>Ù†ØµØ§Ø¦Ø­</h2>
          <ul>
            <li>Ù„Ø§ ÙŠØªÙ… Ø±ÙØ¹ Ø£ÙŠ Ù…Ù„Ù â€” Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ù…Ø­ÙÙˆØ¸Ø©.</li>
            <li>Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚Ø¯ ØªÙØ´Ù„ â€” Ø£Ø²Ù„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- CV BUILDER -->
    <section id="panel-cv" class="panel">
      <div class="grid">
        <div class="card">
          <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</h2>
          <div class="field"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input id="cv-name" placeholder="Ø§Ù„Ø§Ø³Ù…" /></div>
          <div class="field"><label>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label><input id="cv-title" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø·ÙˆÙ‘Ø± ÙˆØ§Ø¬Ù‡Ø§Øª" /></div>
          <div class="field"><label>Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‡Ù†ÙŠ</label><textarea id="cv-summary" placeholder="Ù†Ø¨Ø°Ø© Ù‚ØµÙŠØ±Ø©â€¦"></textarea></div>
          <div class="field"><label>Ø§Ù„Ø®Ø¨Ø±Ø§Øª (ÙƒÙ„ Ø®Ø¨Ø±Ø© ÙÙŠ Ø³Ø·Ø±)</label><textarea id="cv-exp" placeholder="Ø§Ù„Ø´Ø±ÙƒØ© â€” Ø§Ù„Ù…Ù†ØµØ¨ â€” Ø§Ù„Ø³Ù†ÙˆØ§Øª"></textarea></div>
          <div class="field"><label>Ø§Ù„ØªØ¹Ù„ÙŠÙ…</label><textarea id="cv-edu" placeholder="Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© â€” Ø§Ù„Ø¯Ø±Ø¬Ø© â€” Ø§Ù„Ø³Ù†ÙˆØ§Øª"></textarea></div>
          <div class="field"><label>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)</label><input id="cv-skills" placeholder="JavaScript, React, Weldingâ€¦" /></div>
          <div class="field"><label>Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input type="file" id="cv-photo" accept="image/*" /></div>
          <div class="row">
            <button class="btn brand" id="cv-generate">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
            <button class="btn good" id="cv-download">ØªØ­Ù…ÙŠÙ„ PDF</button>
            <button class="btn" id="cv-clear">ØªÙØ±ÙŠØº</button>
          </div>
        </div>

        <div class="card cv">
          <h2 style="margin-bottom:10px">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</h2>
          <div id="cv-sheet" class="sheet" aria-label="Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©">
            <div class="cv-header">
              <div class="avatar" id="cv-avatar"></div>
              <div>
                <div id="cv-name-v" style="font-size:26px;font-weight:800">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</div>
                <div id="cv-title-v" style="opacity:.95">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</div>
              </div>
            </div>
            <div class="cv-body">
              <aside class="cv-side">
                <h3 style="margin-top:0">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
                <div id="cv-skills-v"></div>
              </aside>
              <main class="cv-main">
                <section>
                  <h3 style="margin-top:0">Ø§Ù„Ù…Ù„Ø®Øµ</h3>
                  <p id="cv-summary-v">Ø§ÙƒØªØ¨ Ù…Ù„Ø®ØµÙƒ Ø§Ù„Ù…Ù‡Ù†ÙŠ Ø¨Ø¥ÙŠØ¬Ø§Ø² ÙˆÙˆØ¶ÙˆØ­.</p>
                </section>
                <section>
                  <h3>Ø§Ù„Ø®Ø¨Ø±Ø§Øª</h3>
                  <div id="cv-exp-v"></div>
                </section>
                <section>
                  <h3>Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h3>
                  <div id="cv-edu-v"></div>
                </section>
              </main>
            </div>
          </div>
          <div class="footer muted">* ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (LocalStorage).</div>
        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="panel-about" class="panel">
      <div class="grid" style="grid-template-columns:1fr">
        <div class="card">
          <h2>Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„ØªØ³Ø¹ÙŠØ±</h2>
          <p class="muted">Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙŠØ¹Ù…Ù„ 100% Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆÙŠÙ…ÙƒÙ† Ù†Ø´Ø±Ù‡ Ø¹Ù„Ù‰ GitHub Pages Ø£Ùˆ Netlify Ø¨Ø³Ù‡ÙˆÙ„Ø©. Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Stripe.</p>
          <ul>
            <li><b>Ù…Ø¬Ø§Ù†ÙŠ:</b> Ø¯Ù…Ø¬ Ø­ØªÙ‰ 10 Ù…Ù„ÙØ§ØªØŒ ØªÙ‚Ø³ÙŠÙ… Ø­ØªÙ‰ 30 ØµÙØ­Ø©ØŒ Ù‚Ø§Ù„Ø¨ CV ÙˆØ§Ø­Ø¯.</li>
            <li><b>Ù…Ø¯ÙÙˆØ¹:</b> ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯ + Ù‚ÙˆØ§Ù„Ø¨ CV Ø¥Ø¶Ø§ÙÙŠØ© + Ø­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠ.</li>
          </ul>
          <p>Ø§Ù„Ø®ØµÙˆØµÙŠØ©: Ù„Ø§ ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ø£ÙŠ Ø®Ø§Ø¯Ù…Ø› ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØªÙ… Ø¯Ø§Ø®Ù„ Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….</p>
        </div>
      </div>
    </section>

    <div class="site-footer">Â© <span id="year"></span> â€” Ù…ÙˆÙ‚Ø¹ Ø®Ø¯Ù…Ø§Øª PDF & CV â€” Ù†Ø³Ø®Ø© Ù…ÙØ¹Ø§Ù„ÙØ¬Ø©</div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    // ===== Tabs =====
    const tabs = document.querySelectorAll('.tab-btn');
    const panels = { pdf: document.getElementById('panel-pdf'), cv: document.getElementById('panel-cv'), about: document.getElementById('panel-about') };
    tabs.forEach(btn=>{
      btn.addEventListener('click',()=>{
        tabs.forEach(b=>b.setAttribute('aria-selected','false'));
        btn.setAttribute('aria-selected','true');
        Object.values(panels).forEach(p=>p.classList.remove('active'));
        panels[btn.dataset.tab].classList.add('active');
      });
    });
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== Helpers =====
    const $ = s => document.querySelector(s);
    function downloadBlob(bytes, filename, type='application/pdf'){
      const blob = new Blob([bytes], {type});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url);
    }
    function slugifyName(s){ const p=(s||'').trim().split(' ').filter(Boolean); return p.join('_') || 'CV'; }

    // ===== MERGE PDF =====
    const mergeInput = $('#merge-input');
    const mergeList = $('#merge-list');
    const mergeFiles = [];
    function refreshMergeList(){
      mergeList.innerHTML = '';
      mergeFiles.forEach((f,idx)=>{
        const li = document.createElement('li');
        li.draggable = true;
        li.innerHTML = `
          <span>${idx+1}. ${f.name} <small class="muted">(${(f.size/1024/1024).toFixed(2)} MB)</small></span>
          <span class="actions">
            <button class="btn" data-action="up" data-i="${idx}" title="Ø£Ø¹Ù„Ù‰">â†‘</button>
            <button class="btn" data-action="down" data-i="${idx}" title="Ø£Ø³ÙÙ„">â†“</button>
            <button class="btn danger" data-action="del" data-i="${idx}">Ø­Ø°Ù</button>
          </span>`;
        mergeList.appendChild(li);
      });
    }
    mergeList.addEventListener('click', (e)=>{
      const i = e.target.dataset.i; const action = e.target.dataset.action; if(i===undefined) return;
      const idx = +i;
      if(action==='del'){ mergeFiles.splice(idx,1); }
      if(action==='up' && idx>0){ const m=mergeFiles.splice(idx,1)[0]; mergeFiles.splice(idx-1,0,m); }
      if(action==='down' && idx<mergeFiles.length-1){ const m=mergeFiles.splice(idx,1)[0]; mergeFiles.splice(idx+1,0,m); }
      refreshMergeList();
    });
    let dragIdx=null;
    mergeList.addEventListener('dragstart', e=>{ const li=e.target.closest('li'); dragIdx = [...mergeList.children].indexOf(li); });
    mergeList.addEventListener('dragover', e=>e.preventDefault());
    mergeList.addEventListener('drop', e=>{
      e.preventDefault(); const li=e.target.closest('li'); const dropIdx = [...mergeList.children].indexOf(li);
      if(dragIdx>=0 && dropIdx>=0 && dragIdx!==dropIdx){ const m=mergeFiles.splice(dragIdx,1)[0]; mergeFiles.splice(dropIdx,0,m); refreshMergeList(); }
      dragIdx=null;
    });
    mergeInput.addEventListener('change', (e)=>{ [...e.target.files].forEach(f=>mergeFiles.push(f)); refreshMergeList(); });
    $('#merge-clear').onclick = ()=>{ mergeFiles.length=0; refreshMergeList(); };
    $('#merge-btn').onclick = async ()=>{
      if(!mergeFiles.length) return alert('Ø£Ø¶Ù Ù…Ù„ÙØ§Øª Ø£ÙˆÙ„Ø§Ù‹');
      try{
        const { PDFDocument } = PDFLib;
        const merged = await PDFDocument.create();
        for(const f of mergeFiles){
          const bytes = await f.arrayBuffer();
          const src = await PDFDocument.load(bytes, { ignoreEncryption:true });
          const pages = await merged.copyPages(src, src.getPageIndices());
          pages.forEach(p=>merged.addPage(p));
        }
        const out = await merged.save({ addDefaultPage:false });
        downloadBlob(out, `merged_${Date.now()}.pdf`);
      }catch(err){ console.error(err); alert('ØªØ¹Ø°Ø± Ø§Ù„Ø¯Ù…Ø¬. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª (Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…Ø­Ù…ÙŠØ© Ø£Ùˆ ØªØ§Ù„ÙØ©).'); }
    };

    // ===== SPLIT PDF =====
    $('#split-clear').onclick = ()=>{ $('#split-input').value=''; $('#ranges').value=''; };
    function parseRanges(str, total){
      const set = new Set();
      str.split(',').map(s=>s.trim()).filter(Boolean).forEach(part=>{
        const m = part.match(/^(\d+)(?:\s*-\s*(\d+))?$/);
        if(!m) return; const a=+m[1]; const b=m[2]?+m[2]:a;
        const from = Math.min(a,b), to = Math.max(a,b);
        for(let i=from;i<=to;i++) if(i>=1 && i<=total) set.add(i-1);
      });
      return [...set].sort((x,y)=>x-y);
    }
    $('#split-btn').onclick = async ()=>{
      const file = $('#split-input').files?.[0];
      const ranges = $('#ranges').value.trim();
      if(!file) return alert('Ø§Ø®ØªØ± Ù…Ù„Ù PDF');
      try{
        const bytes = await file.arrayBuffer();
        const { PDFDocument } = PDFLib;
        const src = await PDFDocument.load(bytes, { ignoreEncryption:true });
        const total = src.getPageCount();
        const indices = ranges ? parseRanges(ranges, total) : src.getPageIndices();
        if(!indices.length) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù†Ø·Ø§Ù‚');
        const outDoc = await PDFDocument.create();
        const pages = await outDoc.copyPages(src, indices);
        pages.forEach(p=>outDoc.addPage(p));
        const out = await outDoc.save();
        downloadBlob(out, `split_${Date.now()}.pdf`);
      }catch(err){ console.error(err); alert('ØªØ¹Ø°Ø± Ø§Ù„ØªÙ‚Ø³ÙŠÙ…. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„Ù†Ø·Ø§Ù‚.'); }
    };

    // ===== IMAGES â†’ PDF =====
    const sizeMap = { a4:{ w:595.28, h:841.89 }, letter:{ w:612, h:792 } }; // Ù†Ù‚Ø§Ø· (pt)
    $('#img2pdf-btn').onclick = async ()=>{
      const files = $('#img2pdf-input').files; if(!files || !files.length) return alert('Ø§Ø®ØªØ± ØµÙˆØ±Ù‹Ø§ Ø£ÙˆÙ„Ø§Ù‹');
      const paper = $('#paper').value; const fit = $('#fit').value; const { jsPDF } = window.jspdf;
      try{
        const pdf = new jsPDF({ unit:'pt', format:[sizeMap[paper].w, sizeMap[paper].h], orientation:'portrait' });
        for(let i=0;i<files.length;i++){
          const img = await fileToImage(files[i]);
          if(i>0) pdf.addPage([sizeMap[paper].w, sizeMap[paper].h]);
          const rect = fitRect(img.width, img.height, sizeMap[paper].w, sizeMap[paper].h, fit);
          pdf.addImage(imageToDataURL(img), 'JPEG', rect.x, rect.y, rect.w, rect.h);
        }
        pdf.save(`images_${Date.now()}.pdf`);
      }catch(err){ console.error(err); alert('ØªØ¹Ø°Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„. Ø¬Ø±Ù‘Ø¨ ØµÙˆØ±Ù‹Ø§ Ø£ØµØºØ±.'); }
    };
    function fileToImage(file){
      return new Promise((resolve,reject)=>{ const reader = new FileReader();
        reader.onload = ()=>{ const img=new Image(); img.onload=()=>resolve(img); img.onerror=reject; img.src=reader.result; };
        reader.onerror=reject; reader.readAsDataURL(file);
      });
    }
    function imageToDataURL(img){ const c=document.createElement('canvas'); c.width=img.width; c.height=img.height; const ctx=c.getContext('2d'); ctx.drawImage(img,0,0); return c.toDataURL('image/jpeg', 0.98); }
    function fitRect(iw, ih, cw, ch, mode='contain'){ const ir=iw/ih, cr=cw/ch; let w,h; if((mode==='contain' && ir>cr) || (mode==='cover' && ir<cr)){ w=cw; h=w/ir; } else { h=ch; w=h*ir; } const x=(cw-w)/2, y=(ch-h)/2; return {x,y,w,h}; }

    // ===== CV BUILDER =====
    const store = (k,v)=>localStorage.setItem(k, JSON.stringify(v));
    const load = (k, def)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? def }catch{ return def } };

    function syncPreview(){
      const name = ($('#cv-name').value || '').trim() || 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„';
      const title = ($('#cv-title').value || '').trim() || 'Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ';
      const summary = ($('#cv-summary').value || '').trim() || 'Ø§ÙƒØªØ¨ Ù…Ù„Ø®ØµÙƒ Ø§Ù„Ù…Ù‡Ù†ÙŠ Ø¨Ø¥ÙŠØ¬Ø§Ø² ÙˆÙˆØ¶ÙˆØ­.';
      const exp = ($('#cv-exp').value || '').split('\n').filter(Boolean);
      const edu = ($('#cv-edu').value || '').split('\n').filter(Boolean);
      const skills = ($('#cv-skills').value || '').split(',').map(s=>s.trim()).filter(Boolean);

      $('#cv-name-v').textContent = name;
      $('#cv-title-v').textContent = title;
      $('#cv-summary-v').textContent = summary;

      const expV = $('#cv-exp-v'); expV.innerHTML=''; exp.forEach(line=>{ const p=document.createElement('p'); p.textContent=line; expV.appendChild(p); });
      const eduV = $('#cv-edu-v'); eduV.innerHTML=''; edu.forEach(line=>{ const p=document.createElement('p'); p.textContent=line; eduV.appendChild(p); });
      const skillsV = $('#cv-skills-v'); skillsV.innerHTML=''; skills.forEach(s=>{ const span=document.createElement('span'); span.className='tag'; span.textContent=s; skillsV.appendChild(span); });

      store('cv-data',{name,title,summary,exp,edu,skills,photo:load('cv-photo',null)});
    }
    $('#cv-generate').onclick = syncPreview;
    $('#cv-clear').onclick = ()=>{
      ['cv-name','cv-title','cv-summary','cv-exp','cv-edu','cv-skills'].forEach(id=>$('#'+id).value='');
      localStorage.removeItem('cv-data'); localStorage.removeItem('cv-photo'); $('#cv-avatar').innerHTML=''; syncPreview();
    };

    // ØªÙ†Ø²ÙŠÙ„ CV ÙƒÙ€ PDF â€” PNG + Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© + A4
    $('#cv-download').onclick = async ()=>{
      const sheet = $('#cv-sheet');
      const name = slugifyName(($('#cv-name').value)||'CV') + '.pdf';

      // Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø®Ø·ÙˆØ· Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„Ù‚Ù…Ø§Ø´ Ø§Ù„Ø£Ø¨ÙŠØ¶
      if(document.fonts && document.fonts.ready){ try{ await document.fonts.ready; }catch{} }

      // Ù†Ø³Ø®Ø© Ù…Ø¹Ø²ÙˆÙ„Ø© Ø¨Ø­Ø¬Ù… A4 Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ (Ù„Ø¶Ù…Ø§Ù† ÙˆØ¶ÙˆØ­ ÙˆØ£Ø¨Ø¹Ø§Ø¯ ØµØ­ÙŠØ­Ø©)
      const A4w = 794, A4h = 1123; // ~ A4 @96dpi
      const clone = sheet.cloneNode(true);
      clone.setAttribute('dir','rtl');
      Object.assign(clone.style, {
        position:'fixed', left:'-10000px', top:'0',
        transform:'none', opacity:'1', background:'#ffffff',
        width: A4w+'px', height: A4h+'px', display:'block'
      });
      document.body.appendChild(clone);
      void clone.offsetHeight; // Ø¥Ø¬Ø¨Ø§Ø± Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯

      const cleanup = ()=>{ try{ clone.remove(); }catch{} };

      try{
        if(window.html2canvas && window.jspdf && window.jspdf.jsPDF){
          const canvas = await window.html2canvas(clone, {
            scale: 3, // Ø²ÙˆÙ‘Ø¯/Ù‚Ù„Ù‘Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø§Ø²
            useCORS: true,
            backgroundColor: '#ffffff',
            logging: false
          });
          const imgData = canvas.toDataURL('image/png'); // PNG = ØªØ¨Ø§ÙŠÙ† Ø£Ø¹Ù„Ù‰
          const pdf = new window.jspdf.jsPDF({ unit:'pt', format:'a4', orientation:'portrait' });
          const pageW = pdf.internal.pageSize.getWidth();
          const pageH = pdf.internal.pageSize.getHeight();
          pdf.addImage(imgData, 'PNG', 0, 0, pageW, pageH, undefined, 'FAST');
          pdf.save(name);
          cleanup();
          return;
        }
        // Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        if(window.html2pdf){
          await window.html2pdf().set({
            filename: name,
            margin: 0,
            image: { type:'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS:true, backgroundColor:'#ffffff' },
            jsPDF: { unit:'pt', format:'a4', orientation:'portrait' }
          }).from(clone).save();
          cleanup();
          return;
        }
        alert('Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ØªØµØ¯ÙŠØ± ØºÙŠØ± Ù…ØªØ§Ø­Ø©.');
      }catch(err){
        console.error(err);
        alert('Ø­Ø¯Ø«Øª Ù…Ø´ÙƒÙ„Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±. Ø¬Ø±Ù‘Ø¨ Ø«Ø§Ù†ÙŠØ© Ø£Ùˆ Ø®ÙÙ‘Ø¶ Ø§Ù„Ù‚ÙŠÙ…Ø© scale.');
      }finally{
        cleanup();
      }
    };

    // ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ±Ø©
    $('#cv-photo').addEventListener('change', e=>{
      const file = e.target.files?.[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{ localStorage.setItem('cv-photo', reader.result); renderAvatar(); };
      reader.readAsDataURL(file);
    });
    function renderAvatar(){ const data = localStorage.getItem('cv-photo'); $('#cv-avatar').innerHTML = data ? `<img src="${data}" alt=""/>` : ''; }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    (function(){
      const data = load('cv-data',null);
      if(data){
        $('#cv-name').value=data.name||'';
        $('#cv-title').value=data.title||'';
        $('#cv-summary').value=data.summary||'';
        $('#cv-exp').value=(data.exp||[]).join('\n');
        $('#cv-edu').value=(data.edu||[]).join('\n');
        $('#cv-skills').value=(data.skills||[]).join(', ');
      }
      renderAvatar(); syncPreview();
    })();
  </script>
</body>
</html>
